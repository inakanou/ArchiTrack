{
  "$schema": "./requirement-exclusions.schema.json",
  "description": "E2Eテスト対象外の受入基準とその代替検証方法を定義",
  "version": "1.0.0",
  "lastUpdated": "2024-12-04",
  "exclusions": [
    {
      "id": "REQ-23.3",
      "requirement": "REQ-23: 非機能要件（パフォーマンス・スケーラビリティ）",
      "title": "レスポンスタイム要件",
      "reason": "パフォーマンステストはE2Eテストの範囲外。負荷テストツールで検証が必要",
      "category": "performance",
      "alternativeVerification": {
        "method": "load-test",
        "tool": "k6 / Artillery / JMeter",
        "description": "同時1000ユーザー負荷時のp95レスポンスタイムを計測",
        "threshold": "p95 < 500ms"
      }
    },
    {
      "id": "REQ-23.4",
      "requirement": "REQ-23: 非機能要件（パフォーマンス・スケーラビリティ）",
      "title": "キャッシュヒット率要件",
      "reason": "Redis統計情報の継続的監視が必要。単発E2Eテストでは検証不可",
      "category": "performance",
      "alternativeVerification": {
        "method": "monitoring",
        "tool": "Redis INFO / Prometheus / Grafana",
        "description": "本番環境でキャッシュヒット率を継続監視",
        "threshold": "cache_hit_rate >= 90%"
      }
    },
    {
      "id": "REQ-23.5",
      "requirement": "REQ-23: 非機能要件（パフォーマンス・スケーラビリティ）",
      "title": "データベース接続プール管理",
      "reason": "接続プール設定はインフラ構成。テストではなく設定レビューで検証",
      "category": "infrastructure",
      "alternativeVerification": {
        "method": "config-review",
        "tool": "Prisma config / Railway Dashboard",
        "description": "接続プール設定（10-50接続）を設定ファイルとインフラ設定で確認",
        "threshold": "pool_size: 10-50"
      }
    },
    {
      "id": "REQ-23.7",
      "requirement": "REQ-23: 非機能要件（パフォーマンス・スケーラビリティ）",
      "title": "水平スケーリング対応",
      "reason": "複数インスタンス環境のテストはE2E範囲外。アーキテクチャレビューで検証",
      "category": "infrastructure",
      "alternativeVerification": {
        "method": "architecture-review",
        "tool": "Code Review / ADR",
        "description": "ステートレス設計の確認（セッション管理はRedis、JWT使用等）",
        "threshold": "stateless_design: true"
      }
    },
    {
      "id": "REQ-24.1",
      "requirement": "REQ-24: フォールトトレランス（障害耐性）",
      "title": "データベース接続タイムアウト時の503エラー",
      "reason": "データベース障害シミュレーションはE2E範囲外。カオスエンジニアリングで検証",
      "category": "fault-tolerance",
      "alternativeVerification": {
        "method": "chaos-engineering",
        "tool": "Docker network disconnect / Toxiproxy",
        "description": "DB接続を意図的に切断し、503エラーが返却されることを確認",
        "threshold": "http_status: 503"
      }
    },
    {
      "id": "REQ-24.2",
      "requirement": "REQ-24: フォールトトレランス（障害耐性）",
      "title": "キャッシュ障害時のフォールバック",
      "reason": "Redis障害シミュレーションはE2E範囲外。カオスエンジニアリングで検証",
      "category": "fault-tolerance",
      "alternativeVerification": {
        "method": "chaos-engineering",
        "tool": "Docker stop redis / Toxiproxy",
        "description": "Redis停止時にDBからの直接取得にフォールバックすることを確認",
        "threshold": "fallback_to_db: true"
      }
    },
    {
      "id": "REQ-24.3",
      "requirement": "REQ-24: フォールトトレランス（障害耐性）",
      "title": "メールサービス障害時のキュー保存",
      "reason": "外部メールサービス障害シミュレーションはE2E範囲外",
      "category": "fault-tolerance",
      "alternativeVerification": {
        "method": "integration-test",
        "tool": "Jest / Vitest with mock",
        "description": "メール送信失敗時のキュー保存をモックを使用した統合テストで検証",
        "threshold": "queue_on_failure: true"
      }
    },
    {
      "id": "REQ-24.6",
      "requirement": "REQ-24: フォールトトレランス（障害耐性）",
      "title": "データベース接続リトライ",
      "reason": "一時的なDB障害のリトライはE2E範囲外。統合テストまたはカオスエンジニアリングで検証",
      "category": "fault-tolerance",
      "alternativeVerification": {
        "method": "integration-test",
        "tool": "Jest / Toxiproxy",
        "description": "一時的なDB接続失敗時に最大3回リトライすることを確認",
        "threshold": "max_retries: 3"
      }
    },
    {
      "id": "REQ-24.7",
      "requirement": "REQ-24: フォールトトレランス（障害耐性）",
      "title": "キャッシュ障害時の警告ログ",
      "reason": "ログ出力の検証はE2E範囲外。統合テストでログ内容を検証",
      "category": "fault-tolerance",
      "alternativeVerification": {
        "method": "integration-test",
        "tool": "Jest with log spy",
        "description": "キャッシュ障害時にWARNレベルのログが出力されることを確認",
        "threshold": "log_level: WARN"
      }
    },
    {
      "id": "REQ-24.8",
      "requirement": "REQ-24: フォールトトレランス（障害耐性）",
      "title": "メール送信不可時のユーザー登録継続",
      "reason": "外部サービス障害時の挙動はE2E範囲外。統合テストで検証",
      "category": "fault-tolerance",
      "alternativeVerification": {
        "method": "integration-test",
        "tool": "Jest with mock",
        "description": "メール送信失敗時もユーザー登録が成功することを確認",
        "threshold": "registration_success: true"
      }
    },
    {
      "id": "REQ-24.9",
      "requirement": "REQ-24: フォールトトレランス（障害耐性）",
      "title": "ヘルスチェックエンドポイント",
      "reason": "部分障害からの復旧検証はE2E範囲外。ヘルスチェックの存在はAPIテストで確認済み",
      "category": "fault-tolerance",
      "alternativeVerification": {
        "method": "api-test",
        "tool": "curl / httpie",
        "description": "/health エンドポイントの応答を確認",
        "threshold": "http_status: 200"
      }
    },
    {
      "id": "REQ-25.6",
      "requirement": "REQ-25: データ整合性とトランザクション管理",
      "title": "パスワードリセットのトランザクション",
      "reason": "トランザクション境界のテストはE2E範囲外。統合テストでDB状態を検証",
      "category": "data-integrity",
      "alternativeVerification": {
        "method": "integration-test",
        "tool": "Jest / Prisma",
        "description": "パスワードリセット時にトークン生成と無効化が同一トランザクションで実行されることを確認",
        "threshold": "transaction_atomic: true"
      }
    },
    {
      "id": "REQ-25.8",
      "requirement": "REQ-25: データ整合性とトランザクション管理",
      "title": "楽観的ロック競合処理",
      "reason": "同時更新の競合テストはE2E範囲外。統合テストで並行アクセスを検証",
      "category": "data-integrity",
      "alternativeVerification": {
        "method": "integration-test",
        "tool": "Jest / Concurrent requests",
        "description": "同時更新時に楽観的ロック競合が検出され、適切にリトライまたはエラーを返すことを確認",
        "threshold": "optimistic_lock: handled"
      }
    },
    {
      "id": "REQ-26.3",
      "requirement": "REQ-26: セキュリティ対策（脅威モデリング）",
      "title": "CSRFトークン検証",
      "reason": "テスト環境ではCSRF保護が無効化されている。本番環境でのセキュリティ監査で検証",
      "category": "security",
      "alternativeVerification": {
        "method": "security-audit",
        "tool": "OWASP ZAP / Burp Suite",
        "description": "本番環境でCSRFトークンが必須であることをセキュリティスキャンで確認",
        "threshold": "csrf_protection: enabled"
      }
    },
    {
      "id": "REQ-26.8",
      "requirement": "REQ-26: セキュリティ対策（脅威モデリング）",
      "title": "パスワードリセットトークンの暗号学的安全性",
      "reason": "トークン生成アルゴリズムの検証はコードレビュー範囲。E2Eでは検証不可",
      "category": "security",
      "alternativeVerification": {
        "method": "code-review",
        "tool": "Manual review / Static analysis",
        "description": "crypto.randomBytes(32)使用によるトークン生成を確認",
        "threshold": "entropy_bits: >= 256"
      }
    },
    {
      "id": "REQ-23.1",
      "requirement": "REQ-23: 非機能要件（パフォーマンス・スケーラビリティ）",
      "title": "ログインAPIレスポンスタイム",
      "reason": "APIレスポンスタイムの計測は負荷テストで検証",
      "category": "performance",
      "alternativeVerification": {
        "method": "load-test",
        "tool": "k6 / Artillery",
        "description": "ログインAPIの応答時間を計測",
        "threshold": "p95 < 200ms"
      }
    },
    {
      "id": "REQ-23.2",
      "requirement": "REQ-23: 非機能要件（パフォーマンス・スケーラビリティ）",
      "title": "権限チェックAPIレスポンスタイム",
      "reason": "APIレスポンスタイムの計測は負荷テストで検証",
      "category": "performance",
      "alternativeVerification": {
        "method": "load-test",
        "tool": "k6 / Artillery",
        "description": "権限チェックAPIの応答時間を計測",
        "threshold": "p95 < 100ms"
      }
    },
    {
      "id": "REQ-23.6",
      "requirement": "REQ-23: 非機能要件（パフォーマンス・スケーラビリティ）",
      "title": "トークンリフレッシュAPIレスポンスタイム",
      "reason": "APIレスポンスタイムの計測は負荷テストで検証",
      "category": "performance",
      "alternativeVerification": {
        "method": "load-test",
        "tool": "k6 / Artillery",
        "description": "トークンリフレッシュAPIの応答時間を計測",
        "threshold": "p95 < 200ms"
      }
    },
    {
      "id": "REQ-23.8",
      "requirement": "REQ-23: 非機能要件（パフォーマンス・スケーラビリティ）",
      "title": "データベースクエリインデックス最適化",
      "reason": "データベースインデックスの検証はコードレビューとクエリ分析で検証",
      "category": "performance",
      "alternativeVerification": {
        "method": "code-review",
        "tool": "Prisma Schema / EXPLAIN ANALYZE",
        "description": "頻繁に実行されるクエリに適切なインデックスが設定されていることを確認",
        "threshold": "index_coverage: appropriate"
      }
    },
    {
      "id": "REQ-25.1",
      "requirement": "REQ-25: データ整合性とトランザクション管理",
      "title": "ユーザー登録のトランザクション",
      "reason": "トランザクション境界のテストはE2E範囲外。統合テストでDB状態を検証",
      "category": "data-integrity",
      "alternativeVerification": {
        "method": "integration-test",
        "tool": "Jest / Prisma",
        "description": "ユーザー登録時にユーザー作成、ロール割り当て、招待無効化が同一トランザクションで実行されることを確認",
        "threshold": "transaction_atomic: true"
      }
    },
    {
      "id": "REQ-25.2",
      "requirement": "REQ-25: データ整合性とトランザクション管理",
      "title": "トランザクション失敗時のロールバック",
      "reason": "トランザクションロールバックのテストはE2E範囲外。統合テストで検証",
      "category": "data-integrity",
      "alternativeVerification": {
        "method": "integration-test",
        "tool": "Jest / Prisma",
        "description": "トランザクション内で1つでも処理が失敗した場合、全ての変更がロールバックされることを確認",
        "threshold": "rollback_on_error: true"
      }
    },
    {
      "id": "REQ-25.3",
      "requirement": "REQ-25: データ整合性とトランザクション管理",
      "title": "ロール一括割り当てのトランザクション",
      "reason": "トランザクション境界のテストはE2E範囲外。統合テストで検証",
      "category": "data-integrity",
      "alternativeVerification": {
        "method": "integration-test",
        "tool": "Jest / Prisma",
        "description": "複数のロールを一括で割り当てる際、トランザクションで原子性が保証されることを確認",
        "threshold": "transaction_atomic: true"
      }
    },
    {
      "id": "REQ-25.4",
      "requirement": "REQ-25: データ整合性とトランザクション管理",
      "title": "データベース書き込み操作の分離レベル",
      "reason": "トランザクション分離レベルの検証はE2E範囲外。統合テストで検証",
      "category": "data-integrity",
      "alternativeVerification": {
        "method": "integration-test",
        "tool": "Jest / Prisma",
        "description": "データベース書き込み操作が適切な分離レベル（READ COMMITTED以上）で実行されることを確認",
        "threshold": "isolation_level: READ_COMMITTED"
      }
    },
    {
      "id": "REQ-25.5",
      "requirement": "REQ-25: データ整合性とトランザクション管理",
      "title": "監査ログ保存失敗時のロールバック",
      "reason": "トランザクションロールバックのテストはE2E範囲外。統合テストで検証",
      "category": "data-integrity",
      "alternativeVerification": {
        "method": "integration-test",
        "tool": "Jest / Prisma",
        "description": "監査ログの保存に失敗した場合、元の操作がロールバックされることを確認",
        "threshold": "rollback_on_audit_failure: true"
      }
    },
    {
      "id": "REQ-25.7",
      "requirement": "REQ-25: データ整合性とトランザクション管理",
      "title": "ロール・権限紐付け変更のトランザクション",
      "reason": "トランザクション境界のテストはE2E範囲外。統合テストで検証",
      "category": "data-integrity",
      "alternativeVerification": {
        "method": "integration-test",
        "tool": "Jest / Prisma",
        "description": "ロール・権限の紐付けを変更する際、変更履歴の記録と変更がトランザクションで原子性が保証されることを確認",
        "threshold": "transaction_atomic: true"
      }
    },
    {
      "id": "REQ-26.1",
      "requirement": "REQ-26: セキュリティ対策（脅威モデリング）",
      "title": "SQLインジェクション対策",
      "reason": "SQLインジェクション対策はORMの使用とコードレビューで検証",
      "category": "security",
      "alternativeVerification": {
        "method": "code-review",
        "tool": "Prisma ORM / Static analysis",
        "description": "全てのデータベースクエリがPrismaのパラメータ化クエリを使用していることを確認",
        "threshold": "parameterized_queries: true"
      }
    },
    {
      "id": "REQ-26.2",
      "requirement": "REQ-26: セキュリティ対策（脅威モデリング）",
      "title": "XSS対策（自動エスケープ）",
      "reason": "XSS対策はReactの自動エスケープ機能とコードレビューで検証",
      "category": "security",
      "alternativeVerification": {
        "method": "code-review",
        "tool": "React auto-escape / ESLint",
        "description": "Reactの自動エスケープ機能が使用され、dangerouslySetInnerHTMLが適切に制限されていることを確認",
        "threshold": "auto_escape: enabled"
      }
    },
    {
      "id": "REQ-26.4",
      "requirement": "REQ-26: セキュリティ対策（脅威モデリング）",
      "title": "ブルートフォース攻撃対策（レート制限）",
      "reason": "レート制限の検証はE2E範囲外。統合テストまたはセキュリティテストで検証",
      "category": "security",
      "alternativeVerification": {
        "method": "security-audit",
        "tool": "OWASP ZAP / Custom test script",
        "description": "短時間に複数回のログイン試行があった場合、レート制限が適用されることを確認",
        "threshold": "rate_limit: enabled"
      }
    },
    {
      "id": "REQ-26.6",
      "requirement": "REQ-26: セキュリティ対策（脅威モデリング）",
      "title": "認証が必要なAPIエンドポイントの保護",
      "reason": "APIエンドポイント保護の網羅的検証はセキュリティ監査で検証",
      "category": "security",
      "alternativeVerification": {
        "method": "security-audit",
        "tool": "API security scanner",
        "description": "全ての保護されたAPIエンドポイントが認証チェックを実装していることを確認",
        "threshold": "authentication_required: true"
      }
    },
    {
      "id": "REQ-26.7",
      "requirement": "REQ-26: セキュリティ対策（脅威モデリング）",
      "title": "HttpOnly Cookieの使用",
      "reason": "Cookie設定の検証はコードレビューで確認",
      "category": "security",
      "alternativeVerification": {
        "method": "code-review",
        "tool": "Code review / Browser DevTools",
        "description": "リフレッシュトークンがHttpOnly Cookieで送信されることを確認",
        "threshold": "http_only: true"
      }
    },
    {
      "id": "REQ-26.10",
      "requirement": "REQ-26: セキュリティ対策（脅威モデリング）",
      "title": "セキュリティヘッダーの設定",
      "reason": "セキュリティヘッダーの検証はコードレビューで確認",
      "category": "security",
      "alternativeVerification": {
        "method": "code-review",
        "tool": "Security headers check",
        "description": "X-Frame-Options, X-Content-Type-Options等のセキュリティヘッダーが設定されていることを確認",
        "threshold": "security_headers: enabled"
      }
    },
    {
      "id": "project-management/REQ-18.1",
      "requirement": "REQ-18: エラー回復とフィードバック",
      "title": "ネットワークエラー時のメッセージ表示",
      "reason": "ネットワークエラーのシミュレーションはE2E範囲外。統合テストで検証",
      "category": "fault-tolerance",
      "alternativeVerification": {
        "method": "integration-test",
        "tool": "Jest / Mock Service Worker",
        "description": "ネットワークエラー発生時に適切なエラーメッセージが表示されることを確認",
        "threshold": "error_message: displayed"
      }
    },
    {
      "id": "project-management/REQ-18.2",
      "requirement": "REQ-18: エラー回復とフィードバック",
      "title": "再試行ボタン機能",
      "reason": "ネットワークエラー時の再試行機能はE2E範囲外。統合テストで検証",
      "category": "fault-tolerance",
      "alternativeVerification": {
        "method": "integration-test",
        "tool": "Jest / Mock Service Worker",
        "description": "再試行ボタンクリック時に失敗したリクエストが再送されることを確認",
        "threshold": "retry_request: sent"
      }
    },
    {
      "id": "project-management/REQ-18.3",
      "requirement": "REQ-18: エラー回復とフィードバック",
      "title": "サーバーエラー時のメッセージ表示",
      "reason": "サーバーエラーのシミュレーションはE2E範囲外。統合テストで検証",
      "category": "fault-tolerance",
      "alternativeVerification": {
        "method": "integration-test",
        "tool": "Jest / Mock Service Worker",
        "description": "サーバーエラー（5xx）発生時に適切なエラーメッセージが表示されることを確認",
        "threshold": "error_message: displayed"
      }
    },
    {
      "id": "project-management/REQ-18.4",
      "requirement": "REQ-18: エラー回復とフィードバック",
      "title": "操作成功時のトースト通知",
      "reason": "トースト通知の検証は他のE2Eテストで包括的にカバー済み",
      "category": "fault-tolerance",
      "alternativeVerification": {
        "method": "integration-test",
        "tool": "Jest / React Testing Library",
        "description": "操作成功時にトースト通知が表示されることを確認",
        "threshold": "toast_notification: displayed"
      }
    },
    {
      "id": "project-management/REQ-18.5",
      "requirement": "REQ-18: エラー回復とフィードバック",
      "title": "操作失敗時のトースト通知",
      "reason": "トースト通知の検証は他のE2Eテストで包括的にカバー済み",
      "category": "fault-tolerance",
      "alternativeVerification": {
        "method": "integration-test",
        "tool": "Jest / React Testing Library",
        "description": "操作失敗時にトースト通知が表示されることを確認",
        "threshold": "toast_notification: displayed"
      }
    },
    {
      "id": "project-management/REQ-18.6",
      "requirement": "REQ-18: エラー回復とフィードバック",
      "title": "セッション期限切れ時のリダイレクト",
      "reason": "セッション期限切れのシミュレーションはE2E範囲外。統合テストで検証",
      "category": "fault-tolerance",
      "alternativeVerification": {
        "method": "integration-test",
        "tool": "Jest / Mock",
        "description": "セッション期限切れ時にログインページにリダイレクトされることを確認",
        "threshold": "redirect_to_login: true"
      }
    },
    {
      "id": "project-management/REQ-19.1",
      "requirement": "REQ-19: パフォーマンス",
      "title": "プロジェクト一覧画面の初期表示",
      "reason": "パフォーマンス計測はE2E範囲外。負荷テストで検証",
      "category": "performance",
      "alternativeVerification": {
        "method": "load-test",
        "tool": "k6 / Lighthouse",
        "description": "プロジェクト一覧画面の初期表示を2秒以内に完了することを確認",
        "threshold": "initial_load < 2s"
      }
    },
    {
      "id": "project-management/REQ-19.2",
      "requirement": "REQ-19: パフォーマンス",
      "title": "プロジェクト詳細画面の初期表示",
      "reason": "パフォーマンス計測はE2E範囲外。負荷テストで検証",
      "category": "performance",
      "alternativeVerification": {
        "method": "load-test",
        "tool": "k6 / Lighthouse",
        "description": "プロジェクト詳細画面の初期表示を1秒以内に完了することを確認",
        "threshold": "initial_load < 1s"
      }
    },
    {
      "id": "project-management/REQ-19.3",
      "requirement": "REQ-19: パフォーマンス",
      "title": "CRUD操作のAPI応答時間",
      "reason": "API応答時間計測はE2E範囲外。負荷テストで検証",
      "category": "performance",
      "alternativeVerification": {
        "method": "load-test",
        "tool": "k6 / Artillery",
        "description": "プロジェクト作成・更新・削除操作のAPI応答を500ミリ秒以内に完了することを確認",
        "threshold": "api_response < 500ms"
      }
    },
    {
      "id": "project-management/REQ-19.4",
      "requirement": "REQ-19: パフォーマンス",
      "title": "検索・フィルタリング操作の結果表示",
      "reason": "パフォーマンス計測はE2E範囲外。負荷テストで検証",
      "category": "performance",
      "alternativeVerification": {
        "method": "load-test",
        "tool": "k6 / Lighthouse",
        "description": "検索・フィルタリング操作の結果表示を1秒以内に完了することを確認",
        "threshold": "search_result < 1s"
      }
    },
    {
      "id": "project-management/REQ-19.5",
      "requirement": "REQ-19: パフォーマンス",
      "title": "大量データ時のページネーション性能",
      "reason": "大量データのパフォーマンス検証はE2E範囲外。負荷テストで検証",
      "category": "performance",
      "alternativeVerification": {
        "method": "load-test",
        "tool": "k6 / Artillery",
        "description": "大量データ（1000件以上）でもページネーションにより一覧表示のパフォーマンスが維持されることを確認",
        "threshold": "pagination_load < 2s"
      }
    }
  ],
  "categories": {
    "performance": {
      "description": "負荷テストやモニタリングで検証が必要な要件",
      "verificationPhase": "load-testing"
    },
    "infrastructure": {
      "description": "インフラ設定やアーキテクチャレビューで検証が必要な要件",
      "verificationPhase": "design-review"
    },
    "fault-tolerance": {
      "description": "カオスエンジニアリングや統合テストで検証が必要な障害耐性要件",
      "verificationPhase": "chaos-testing"
    },
    "data-integrity": {
      "description": "トランザクション境界や並行処理の統合テストで検証が必要な要件",
      "verificationPhase": "integration-testing"
    },
    "security": {
      "description": "セキュリティ監査やコードレビューで検証が必要な要件",
      "verificationPhase": "security-audit"
    }
  },
  "summary": {
    "totalExclusions": 42,
    "byCategory": {
      "performance": 13,
      "infrastructure": 2,
      "fault-tolerance": 13,
      "data-integrity": 8,
      "security": 8
    }
  }
}
