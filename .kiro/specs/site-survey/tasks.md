# Implementation Plan

## Task Overview

現場調査機能の実装タスク一覧です。全14要件をカバーし、データベース層からバックエンド、フロントエンド、統合テストまで段階的に実装します。

---

## Tasks

### Phase 1: データベース基盤

- [x] 1. データベーススキーマの実装
- [x] 1.1 (P) 現場調査・画像・注釈のPrismaモデルを定義する
  - SiteSurvey、SurveyImage、ImageAnnotationの3モデルを追加
  - プロジェクトとの関連付け（外部キー制約）を設定
  - インデックス（projectId、surveyDate、deletedAt、displayOrder）を定義
  - カスケード削除の設定を行う
  - _Requirements: 1.1, 1.4, 1.6_

- [x] 1.2 マイグレーションを作成・適用する
  - Prismaマイグレーションファイルを生成
  - 開発環境・テスト環境への適用を確認
  - 1.1の完了後に実行
  - _Requirements: 1.1_

### Phase 2: ストレージ基盤

- [x] 2. Cloudflare R2ストレージ統合
- [x] 2.1 (P) R2クライアント設定を実装する
  - S3Clientのシングルトン初期化を実装
  - 環境変数（R2_ENDPOINT、R2_ACCESS_KEY_ID、R2_SECRET_ACCESS_KEY、R2_BUCKET_NAME）の設定
  - 接続テストユーティリティを追加
  - _Requirements: 4.1, 14.6_

- [x] 2.2 (P) 署名付きURL生成・検証機能を実装する
  - getSignedUrlによる一時的なアクセスURL生成（有効期限15分）
  - オリジナル画像用とサムネイル用の両方に対応
  - 署名付きURLの有効期限検証機能
  - リクエストユーザーのプロジェクトアクセス権限検証機能
  - _Requirements: 4.1, 12.4, 14.6_

### Phase 3: バックエンドサービス層

- [x] 3. 現場調査サービスの実装
- [x] 3.1 現場調査の作成機能を実装する
  - プロジェクト存在確認のバリデーション
  - 必須フィールド（名前、調査日）の検証
  - 監査ログへの記録
  - _Requirements: 1.1, 1.6, 12.5_

- [x] 3.2 現場調査の詳細取得機能を実装する
  - 関連する画像一覧の取得を含む
  - プロジェクト基本情報の取得
  - 論理削除されたレコードの除外
  - _Requirements: 1.2_

- [x] 3.3 現場調査の更新機能を実装する
  - 楽観的排他制御（expectedUpdatedAt）の実装
  - 競合時のエラーレスポンス
  - 監査ログへの記録
  - _Requirements: 1.3, 1.5, 12.5_

- [x] 3.4 現場調査の削除機能を実装する
  - 論理削除（deletedAtの設定）
  - 関連画像の連動削除処理
  - 監査ログへの記録
  - _Requirements: 1.4, 12.5_

- [x] 3.5 現場調査の一覧・検索機能を実装する
  - プロジェクト単位でのページネーション
  - キーワード検索（名前・メモの部分一致）
  - 調査日によるフィルタリング
  - ソート機能（調査日・作成日・更新日）
  - サムネイル画像URLの取得
  - _Requirements: 3.1, 3.2, 3.3, 3.4, 3.5_

- [x] 4. 画像サービスの実装
- [x] 4.1 画像アップロード機能を実装する
  - Multerによるファイル受信（メモリストレージ）
  - ファイル形式バリデーション（JPEG、PNG、WEBP）
  - MIMEタイプとマジックバイトの二重検証
  - ファイル名サニタイズ
  - _Requirements: 4.1, 4.5, 4.8_

- [x] 4.2 画像圧縮・サムネイル生成機能を実装する
  - Sharpによる画像処理
  - 300KB超過時の段階的圧縮（品質を10%ずつ下げながらリサイズ、250KB〜350KB範囲に収める）
  - サムネイル生成（200x200px）
  - 画像メタデータ（幅・高さ・サイズ）の取得
  - _Requirements: 4.4, 4.6_

- [x] 4.3 バッチアップロード機能を実装する
  - 複数ファイルの同時選択対応
  - 5件を超える場合は5件ずつキュー処理して順次アップロード
  - 表示順序の自動設定
  - 進捗状況の追跡
  - _Requirements: 4.2, 4.3_

- [x] 4.4 画像順序変更機能を実装する
  - ドラッグアンドドロップによる順序変更のバックエンド対応
  - 一括更新処理
  - _Requirements: 4.9, 4.10_

- [x] 4.5 画像削除機能を実装する
  - データベースからのメタデータ削除
  - R2からのファイル削除（原画像・サムネイル両方）
  - 関連する注釈データの削除
  - 削除失敗時の孤立ファイルログ記録
  - _Requirements: 4.7_

- [x] 5. 注釈サービスの実装
- [x] 5.1 注釈データの保存機能を実装する
  - Fabric.js JSON形式での保存
  - バージョン管理（スキーマバージョン1.0）
  - 楽観的排他制御の実装
  - _Requirements: 9.1, 9.4_

- [x] 5.2 注釈データの取得・復元機能を実装する
  - 画像IDによる注釈データ取得
  - JSONデータの検証
  - _Requirements: 9.2_

- [x] 5.3 注釈データのJSONエクスポート機能を実装する
  - Fabric.jsフォーマット準拠のJSONエクスポート
  - ダウンロード用レスポンス生成
  - _Requirements: 9.6_

### Phase 4: バックエンドAPI層

- [x] 6. APIルーティングの実装
- [x] 6.1 (P) 現場調査CRUDエンドポイントを実装する
  - POST /api/projects/:projectId/site-surveys（作成）
  - GET /api/projects/:projectId/site-surveys（一覧）
  - GET /api/site-surveys/:id（詳細）
  - PUT /api/site-surveys/:id（更新）
  - DELETE /api/site-surveys/:id（削除）
  - Zodスキーマによるリクエストバリデーション
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 3.1_

- [x] 6.2 (P) 画像管理エンドポイントを実装する
  - POST /api/site-surveys/:id/images（アップロード、multipart/form-data）
  - GET /api/site-surveys/:id/images（一覧）
  - PUT /api/site-surveys/:id/images/order（順序変更）
  - DELETE /api/site-surveys/images/:imageId（削除）
  - _Requirements: 4.1, 4.2, 4.7, 4.9, 4.10_

- [x] 6.3 (P) 注釈管理エンドポイントを実装する
  - GET /api/site-surveys/images/:imageId/annotations（取得）
  - PUT /api/site-surveys/images/:imageId/annotations（保存）
  - GET /api/site-surveys/images/:imageId/annotations/export（JSONエクスポート）
  - _Requirements: 9.1, 9.2, 9.6_

- [x] 6.4 アクセス制御ミドルウェアを適用する
  - 認証ミドルウェアの適用
  - プロジェクト単位の権限チェック
  - site_survey:create、site_survey:read、site_survey:update、site_survey:delete権限の確認
  - _Requirements: 12.1, 12.2, 12.3_

### Phase 5: フロントエンドAPI層

- [ ] 7. フロントエンドAPIクライアントの実装
- [x] 7.1 (P) 現場調査APIクライアントを実装する
  - 現場調査CRUD操作のAPI呼び出し
  - 型安全なレスポンス型定義
  - エラーハンドリング
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 3.1_

- [x] 7.2 (P) 画像管理APIクライアントを実装する
  - 画像アップロード（FormData対応）
  - バッチアップロード対応
  - 画像削除・順序変更API呼び出し
  - _Requirements: 4.1, 4.2, 4.7, 4.10_

- [ ] 7.3 (P) 注釈管理APIクライアントを実装する
  - 注釈データの取得・保存API呼び出し
  - JSONエクスポートAPI呼び出し
  - _Requirements: 9.1, 9.2, 9.6_

### Phase 6: フロントエンド基盤コンポーネント

- [ ] 8. 現場調査一覧ページの実装
- [ ] 8.1 現場調査一覧表示コンポーネントを実装する
  - プロジェクト配下の現場調査一覧表示
  - サムネイル画像表示
  - ページネーションUI
  - _Requirements: 3.1, 3.5_

- [ ] 8.2 検索・フィルタリングUIを実装する
  - キーワード検索フォーム
  - 調査日範囲フィルター
  - ソート切り替え（調査日・作成日・更新日）
  - _Requirements: 3.2, 3.3, 3.4_

- [ ] 8.3 レスポンシブ対応を実装する
  - デスクトップ・タブレット・スマートフォン対応
  - グリッド/リスト表示切り替え
  - _Requirements: 13.1_

- [ ] 9. 現場調査詳細ページの実装
- [ ] 9.1 現場調査基本情報表示を実装する
  - 調査名、調査日、メモの表示
  - 編集ボタン・削除ボタン
  - プロジェクトへの戻り導線
  - _Requirements: 1.2_

- [ ] 9.2 画像一覧グリッド表示を実装する
  - サムネイルによる画像一覧
  - 固定の表示順序
  - ドラッグアンドドロップによる順序変更
  - 画像クリックでビューア/エディタ起動
  - _Requirements: 4.9, 4.10_

- [ ] 9.3 画像アップロードUIを実装する
  - ファイル選択ダイアログ
  - 複数ファイル選択対応
  - ドラッグアンドドロップアップロード
  - アップロード進捗表示
  - エラー表示（形式不正、サイズ超過）
  - モバイル環境でのカメラ連携
  - _Requirements: 4.1, 4.2, 4.5, 4.6, 13.3_

- [ ] 9.4 現場調査作成・編集フォームを実装する
  - 調査名（必須、最大200文字）入力
  - 調査日選択
  - メモ（最大2000文字）入力
  - バリデーションエラー表示
  - _Requirements: 1.1, 1.3_

- [ ] 10. 画面遷移・ナビゲーションの実装
- [ ] 10.1 プロジェクト詳細から現場調査への導線を実装する
  - プロジェクト詳細画面に「現場調査」タブまたはセクションを追加
  - 現場調査一覧への遷移
  - _Requirements: 2.1, 2.2_

- [ ] 10.2 ブレッドクラムナビゲーションを実装する
  - 「プロジェクト名 > 現場調査一覧 > 現場調査名」の階層表示
  - 各項目のクリックで対応画面へ遷移
  - _Requirements: 2.5, 2.6, 2.7_

- [ ] 10.3 現場調査詳細から画像ビューアへの導線を実装する
  - 現場調査一覧から詳細画面への遷移
  - 詳細画面から画像ビューア/エディタへの遷移
  - _Requirements: 2.3, 2.4_

- [ ] 11. 競合検出・エラーハンドリングの実装
- [ ] 11.1 楽観的排他制御の競合ダイアログを実装する
  - 競合検出時の確認ダイアログ
  - 再読み込み促進メッセージ
  - _Requirements: 1.5_

- [ ] 11.2 エラー表示の実装
  - バリデーションエラー表示
  - ネットワークエラー表示
  - Sentryへのエラーログ送信
  - _Requirements: 14.8_

### Phase 7: 画像ビューアの実装

- [ ] 12. 画像ビューアコンポーネントの実装
- [ ] 12.1 基本ビューア機能を実装する
  - モーダル/専用画面での画像表示
  - Fabric.js Canvasの初期化
  - 画像の読み込みと表示
  - _Requirements: 5.1_

- [ ] 12.2 ズーム機能を実装する
  - マウスホイールによるズームイン/ズームアウト
  - ズームボタンUI
  - ズーム範囲制限（0.1x-10x）
  - _Requirements: 5.2_

- [ ] 12.3 回転機能を実装する
  - 90度単位の回転ボタン
  - 回転状態の保持
  - _Requirements: 5.3_

- [ ] 12.4 パン機能を実装する
  - ドラッグによる表示領域移動
  - 拡大時のスクロール対応
  - _Requirements: 5.4_

- [ ] 12.5 タッチ操作対応を実装する
  - ピンチズーム
  - 2本指によるパン操作
  - タッチイベントのハンドリング
  - _Requirements: 5.5, 13.2_

- [ ] 12.6 表示状態の共有機能を実装する
  - ズーム・回転・位置の状態管理
  - 注釈エディタとの状態同期
  - _Requirements: 5.6_

### Phase 8: 注釈エディタ基盤の実装

- [ ] 13. 注釈エディタ基盤コンポーネントの実装
- [ ] 13.1 Fabric.js Canvas統合を実装する
  - useRef + useEffectによるCanvas初期化
  - dispose処理の実装（クリーンアップ）
  - 背景画像の設定
  - _Requirements: 6.1, 7.1, 8.1_

- [ ] 13.2 ツール切り替えUIを実装する
  - ツールバーコンポーネント
  - 選択ツール、寸法線、矢印、円、四角形、多角形、折れ線、フリーハンド、テキストの切り替え
  - アクティブツールの視覚的フィードバック
  - _Requirements: 6.1, 7.1, 8.1_

- [ ] 13.3 オブジェクト選択・操作機能を実装する
  - クリックによるオブジェクト選択
  - 選択オブジェクトのハイライト表示
  - ドラッグによる移動
  - ハンドルによるリサイズ
  - Deleteキーによる削除
  - _Requirements: 6.4, 6.5, 6.6, 7.7, 7.8, 7.9_

- [ ] 13.4 スタイル設定パネルを実装する
  - 色選択（線色、塗りつぶし色）
  - 線の太さ設定
  - フォントサイズ設定（テキスト用）
  - _Requirements: 6.7, 7.10, 8.5_

### Phase 9: 注釈ツールの実装

- [ ] 14. 寸法線ツールの実装
- [ ] 14.1 寸法線描画機能を実装する
  - 2点クリックによる寸法線描画
  - 端点間の直線と垂直線（エンドキャップ）
  - カスタムFabric.jsオブジェクト実装
  - _Requirements: 6.1_

- [ ] 14.2 寸法値入力機能を実装する
  - 寸法線描画後のテキストフィールド表示
  - 数値と単位の入力
  - 寸法線上への値表示
  - _Requirements: 6.2, 6.3_

- [ ] 14.3 寸法線編集機能を実装する
  - 端点のドラッグによる位置調整
  - 寸法値の再編集
  - スタイル変更（色、線の太さ）
  - _Requirements: 6.4, 6.5, 6.7_

- [ ] 15. マーキングツール（図形）の実装
- [ ] 15.1 (P) 矢印ツールを実装する
  - ドラッグによる矢印描画
  - 矢印の方向（開始点→終了点）
  - _Requirements: 7.1_

- [ ] 15.2 (P) 円・楕円ツールを実装する
  - ドラッグによる円/楕円描画
  - 中心点と半径の計算
  - _Requirements: 7.2_

- [ ] 15.3 (P) 四角形ツールを実装する
  - ドラッグによる長方形描画
  - _Requirements: 7.3_

- [ ] 15.4 (P) 多角形ツールを実装する
  - クリックによる頂点追加
  - ダブルクリックで閉じる
  - _Requirements: 7.4_

- [ ] 15.5 (P) 折れ線ツールを実装する
  - クリックによる点追加
  - ダブルクリックで終了
  - _Requirements: 7.5_

- [ ] 15.6 (P) フリーハンドツールを実装する
  - Fabric.js PencilBrushの活用
  - 描画の滑らかさ調整
  - _Requirements: 7.6_

- [ ] 16. テキストツールの実装
- [ ] 16.1 テキスト入力機能を実装する
  - クリック位置へのテキストフィールド表示
  - 日本語を含むマルチバイト文字対応
  - _Requirements: 8.1, 8.7_

- [ ] 16.2 テキスト編集機能を実装する
  - ダブルクリックによる編集モード
  - フォントサイズ・色・背景色の変更
  - _Requirements: 8.2, 8.3, 8.5_

- [ ] 16.3 吹き出し形式を実装する
  - 吹き出しスタイルの選択UI
  - テキストを囲む吹き出し図形の描画
  - _Requirements: 8.6_

### Phase 10: 編集支援機能の実装

- [ ] 17. Undo/Redo機能の実装
- [ ] 17.1 UndoManagerを実装する
  - コマンドパターンによる操作履歴管理
  - 最大50件の履歴保持、超過時は最古の履歴から削除（FIFO）
  - execute/undo/redoメソッド
  - _Requirements: 11.1, 11.2, 11.4_

- [ ] 17.2 Fabric.jsイベント連携を実装する
  - object:added、object:modified、object:removedイベントのキャプチャ
  - コマンドオブジェクトの生成
  - _Requirements: 11.1, 11.2_

- [ ] 17.3 キーボードショートカットを実装する
  - Ctrl/Cmd+Z（Undo）
  - Ctrl/Cmd+Shift+Z（Redo）
  - _Requirements: 11.3_

- [ ] 17.4 履歴クリア処理を実装する
  - 保存時の履歴クリア
  - canUndo/canRedoの状態更新
  - _Requirements: 11.5_

- [ ] 18. 自動保存・状態復元機能の実装
- [ ] 18.1 AutoSaveManagerを実装する
  - 30秒間隔のdebounce自動保存
  - localStorageへの注釈データ保存
  - 画像ID・調査ID・保存時刻の管理
  - _Requirements: 13.4_

- [ ] 18.2 localStorage容量管理を実装する
  - LRU方式での古いキャッシュ削除
  - 最大4MBの容量制限
  - QuotaExceededError時のエラーハンドリング
  - _Requirements: 13.5_

- [ ] 18.3 状態復元機能を実装する
  - ページリロード時のlocalStorageチェック
  - 未保存データ復元確認ダイアログ
  - サーバーデータとの比較・選択
  - _Requirements: 13.5_

- [ ] 18.4 ネットワーク状態監視を実装する
  - navigator.onLineによる接続状態監視
  - オフライン時の警告表示
  - 保存操作のブロック
  - オンライン復帰時の通知
  - _Requirements: 13.6_

- [ ] 19. 未保存変更の検出を実装する
  - isDirtyフラグの管理
  - ページ離脱時の確認ダイアログ（beforeunload）
  - _Requirements: 9.3_

### Phase 11: エクスポート機能の実装

- [ ] 20. 画像エクスポート機能の実装
- [ ] 20.1 注釈付き画像のエクスポートを実装する
  - Fabric.js toDataURLによる画像生成
  - JPEG/PNG形式選択
  - 解像度（品質）選択
  - _Requirements: 10.1, 10.2, 10.3_

- [ ] 20.2 元画像ダウンロード機能を実装する
  - 注釈なしの原画像ダウンロード
  - 署名付きURLからのダウンロード
  - _Requirements: 10.4_

- [ ] 20.3 日本語テキストのレンダリング対応を実装する
  - Canvasへの日本語フォント適用
  - エクスポート画像での日本語表示確認
  - _Requirements: 10.5_

- [ ] 21. PDF報告書生成機能の実装
- [ ] 21.1 日本語フォント埋め込みを実装する
  - Noto Sans JPフォントのサブセット化（約500KB）
  - jsPDFへのフォント登録
  - Base64エンコードによるバンドル
  - _Requirements: 10.6_

- [ ] 21.2 PDF報告書レイアウトを実装する
  - 表紙（調査名、調査日、プロジェクト名）
  - 基本情報セクション（メモ含む）
  - 画像一覧セクション（注釈付き画像）
  - ページ番号
  - _Requirements: 10.6, 10.7_

- [ ] 21.3 PDF生成・ダウンロードを実装する
  - jsPDFによるクライアントサイド生成
  - プログレス表示（大量画像時）
  - ダウンロードトリガー
  - _Requirements: 10.6_

### Phase 12: 統合と最適化

- [ ] 22. フロントエンド統合
- [ ] 22.1 ルーティング設定を実装する
  - /projects/:projectId/site-surveys（一覧）
  - /projects/:projectId/site-surveys/new（作成）
  - /site-surveys/:id（詳細）
  - /site-surveys/:id/edit（編集）
  - /site-surveys/:id/images/:imageId（ビューア/エディタ）
  - _Requirements: 1.1, 1.2, 1.3, 3.1_

- [ ] 22.2 プロジェクト詳細画面との連携を実装する
  - プロジェクト詳細から現場調査一覧へのナビゲーション
  - パンくずナビゲーション
  - _Requirements: 2.1_

- [ ] 22.3 アクセス権限によるUI制御を実装する
  - 閲覧権限のみの場合の編集ボタン非表示
  - 操作拒否時のエラーメッセージ
  - _Requirements: 12.1, 12.2, 12.3_

- [ ] 23. パフォーマンス最適化
- [ ] 23.1 画像遅延読み込みを実装する
  - IntersectionObserverによる遅延読み込み
  - サムネイル優先表示
  - _Requirements: 14.1_

- [ ] 23.2 Canvas描画最適化を実装する
  - オブジェクトキャッシングの有効化
  - 不要な再描画の抑制
  - 大量オブジェクト時の描画パフォーマンス確保
  - _Requirements: 14.2_

### Phase 13: テスト

- [ ] 24. バックエンド単体テストの実装
- [ ] 24.1 (P) SurveyServiceの単体テストを実装する
  - CRUD操作のテスト
  - 楽観的排他制御のテスト
  - プロジェクト存在確認のテスト
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5, 1.6_

- [ ] 24.2 (P) ImageServiceの単体テストを実装する
  - 画像アップロードのテスト
  - 圧縮・サムネイル生成のテスト
  - ファイル形式バリデーションのテスト
  - バッチアップロードのキュー処理テスト
  - _Requirements: 4.1, 4.2, 4.3, 4.4, 4.5, 4.6, 4.7, 4.8_

- [ ] 24.3 (P) AnnotationServiceの単体テストを実装する
  - 注釈保存・取得のテスト
  - JSONエクスポートのテスト
  - _Requirements: 9.1, 9.2, 9.6_

- [ ] 25. フロントエンド単体テストの実装
- [ ] 25.1 (P) 現場調査関連コンポーネントのテストを実装する
  - 一覧表示コンポーネントのテスト
  - フォームコンポーネントのテスト
  - _Requirements: 1.1, 1.3, 3.1_

- [ ] 25.2 (P) 画像関連コンポーネントのテストを実装する
  - アップロードUIのテスト
  - 画像グリッドのテスト
  - _Requirements: 4.1, 4.2_

- [ ] 25.3 (P) 注釈エディタのテストを実装する
  - ツール切り替えのテスト
  - Undo/Redoのテスト
  - 自動保存のテスト
  - _Requirements: 11.1, 11.2, 13.4_

- [ ] 26. 統合・E2Eテストの実装
- [ ] 26.1 バックエンド統合テストを実装する
  - APIエンドポイントの統合テスト
  - 認証・認可フローのテスト
  - R2連携のテスト（モック使用）
  - _Requirements: 12.1, 12.2, 12.3, 12.5_

- [ ] 26.2 E2Eテストを実装する
  - 現場調査作成・編集・削除フローのテスト
  - 画像アップロード・削除フローのテスト
  - 注釈編集・保存フローのテスト
  - PDF出力のテスト
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 4.1, 4.7, 9.1, 10.6_

---

## Requirements Coverage

| 要件 | タスク                                               |
| ---- | ---------------------------------------------------- |
| 1.1  | 1.1, 1.2, 3.1, 6.1, 7.1, 9.4, 22.1, 24.1, 25.1, 26.2 |
| 1.2  | 3.2, 6.1, 9.1, 22.1, 26.2                            |
| 1.3  | 3.3, 6.1, 9.4, 22.1, 25.1, 26.2                      |
| 1.4  | 1.1, 3.4, 6.1, 26.2                                  |
| 1.5  | 3.3, 11.1, 24.1                                      |
| 1.6  | 1.1, 3.1, 24.1                                       |
| 2.1  | 10.1, 22.2                                           |
| 2.2  | 10.1                                                 |
| 2.3  | 10.3                                                 |
| 2.4  | 10.3                                                 |
| 2.5  | 10.2                                                 |
| 2.6  | 10.2                                                 |
| 2.7  | 10.2                                                 |
| 3.1  | 3.5, 6.1, 7.1, 8.1, 22.1, 25.1                       |
| 3.2  | 3.5, 8.2                                             |
| 3.3  | 3.5, 8.2                                             |
| 3.4  | 3.5, 8.2                                             |
| 3.5  | 3.5, 8.1                                             |
| 4.1  | 2.1, 4.1, 6.2, 7.2, 9.3, 24.2, 25.2, 26.2            |
| 4.2  | 4.3, 6.2, 7.2, 9.3, 24.2, 25.2                       |
| 4.3  | 4.3, 24.2                                            |
| 4.4  | 4.2, 24.2                                            |
| 4.5  | 4.1, 9.3, 24.2                                       |
| 4.6  | 4.2, 9.3, 24.2                                       |
| 4.7  | 4.5, 6.2, 7.2, 24.2, 26.2                            |
| 4.8  | 4.1, 24.2                                            |
| 4.9  | 4.4, 9.2                                             |
| 4.10 | 4.4, 6.2, 7.2, 9.2                                   |
| 5.1  | 12.1                                                 |
| 5.2  | 12.2                                                 |
| 5.3  | 12.3                                                 |
| 5.4  | 12.4                                                 |
| 5.5  | 12.5                                                 |
| 5.6  | 12.6                                                 |
| 6.1  | 13.1, 13.2, 14.1                                     |
| 6.2  | 14.2                                                 |
| 6.3  | 14.2                                                 |
| 6.4  | 13.3, 14.3                                           |
| 6.5  | 13.3, 14.3                                           |
| 6.6  | 13.3                                                 |
| 6.7  | 13.4, 14.3                                           |
| 7.1  | 13.1, 13.2, 15.1                                     |
| 7.2  | 15.2                                                 |
| 7.3  | 15.3                                                 |
| 7.4  | 15.4                                                 |
| 7.5  | 15.5                                                 |
| 7.6  | 15.6                                                 |
| 7.7  | 13.3                                                 |
| 7.8  | 13.3                                                 |
| 7.9  | 13.3                                                 |
| 7.10 | 13.4                                                 |
| 8.1  | 13.1, 13.2, 16.1                                     |
| 8.2  | 16.2                                                 |
| 8.3  | 16.2                                                 |
| 8.4  | 13.3                                                 |
| 8.5  | 13.4, 16.2                                           |
| 8.6  | 16.3                                                 |
| 8.7  | 16.1                                                 |
| 9.1  | 5.1, 6.3, 7.3, 24.3, 26.2                            |
| 9.2  | 5.2, 6.3, 7.3, 24.3                                  |
| 9.3  | 19                                                   |
| 9.4  | 5.1                                                  |
| 9.5  | 11.2                                                 |
| 9.6  | 5.3, 7.3, 24.3                                       |
| 10.1 | 20.1                                                 |
| 10.2 | 20.1                                                 |
| 10.3 | 20.1                                                 |
| 10.4 | 20.2                                                 |
| 10.5 | 20.3                                                 |
| 10.6 | 21.1, 21.2, 21.3, 26.2                               |
| 10.7 | 21.2                                                 |
| 11.1 | 17.1, 17.2, 25.3                                     |
| 11.2 | 17.1, 17.2, 25.3                                     |
| 11.3 | 17.3                                                 |
| 11.4 | 17.1                                                 |
| 11.5 | 17.4                                                 |
| 12.1 | 6.4, 22.3, 26.1                                      |
| 12.2 | 6.4, 22.3, 26.1                                      |
| 12.3 | 6.4, 22.3, 26.1                                      |
| 12.4 | 2.2, 26.1                                            |
| 12.5 | 3.1, 3.3, 3.4, 26.1                                  |
| 13.1 | 8.3                                                  |
| 13.2 | 12.5                                                 |
| 13.3 | 9.3                                                  |
| 13.4 | 18.1, 25.3                                           |
| 13.5 | 18.2, 18.3                                           |
| 13.6 | 18.4                                                 |
| 14.1 | 23.1                                                 |
| 14.2 | 23.2                                                 |
| 14.3 | 4.2                                                  |
| 14.4 | (インフラレベル、タスク対象外)                       |
| 14.5 | (インフラレベル、タスク対象外)                       |
| 14.6 | 2.1, 2.2                                             |
| 14.7 | (運用レベル、タスク対象外)                           |
| 14.8 | 11.2                                                 |
