# Requirements Document

## Introduction

取引先管理機能は、ArchiTrackにおける取引先（顧客および協力業者）の情報を一元管理するための機能です。取引先はプロジェクト管理機能において顧客として選択される候補となり、プロジェクトとの紐付けを通じて業務フローを支援します。

本機能により、ユーザーは取引先の登録・参照・更新・削除を効率的に行い、プロジェクト管理との連携を実現します。

## Requirements

### Requirement 1: 取引先一覧表示

**Objective:** As a ユーザー, I want 登録済みの取引先を一覧で確認したい, so that 取引先の全体像を把握し、必要な取引先を素早く見つけることができる

#### Acceptance Criteria

1. When ユーザーが取引先一覧ページにアクセスしたとき, the 取引先管理サービス shall 登録済みの取引先をテーブル形式で表示する
2. The 取引先管理サービス shall 取引先名、フリガナ、敬称、取引先種別（顧客/協力業者）、住所、電話番号、登録日を一覧に表示する
3. When ユーザーが検索条件を入力したとき, the 取引先管理サービス shall 取引先名またはフリガナによる部分一致検索を実行する
4. When ユーザーがフィルター条件を選択したとき, the 取引先管理サービス shall 取引先種別（顧客/協力業者）でのフィルタリングを実行する
5. The 取引先管理サービス shall ページネーションを提供し、1ページあたりの表示件数を選択可能とする
6. When ユーザーがソート列をクリックしたとき, the 取引先管理サービス shall 指定された列（取引先名、フリガナ、登録日等）で昇順または降順にソートする
7. While 取引先データが存在しないとき, the 取引先管理サービス shall 「取引先が登録されていません」というメッセージを表示する

### Requirement 2: 取引先新規作成

**Objective:** As a ユーザー, I want 新しい取引先を登録したい, so that プロジェクトに紐付ける顧客や協力業者を管理できる

#### Acceptance Criteria

1. When ユーザーが「新規作成」ボタンをクリックしたとき, the 取引先管理サービス shall 取引先作成フォームを表示する
2. The 取引先管理サービス shall 以下の必須入力欄を提供する: 名前、フリガナ、敬称（御中/様）、種別（顧客/協力業者、複数選択可）、住所
3. The 取引先管理サービス shall 以下の任意入力欄を提供する: 電話番号、FAX番号、メールアドレス、請求締日、支払日、備考
4. The 取引先管理サービス shall 敬称選択肢として「御中」と「様」をラジオボタンまたはドロップダウンで提供する
5. The 取引先管理サービス shall 種別選択肢として「顧客」と「協力業者」をチェックボックスで提供し、複数選択を可能とする
6. When ユーザーが有効なデータを入力して保存ボタンをクリックしたとき, the 取引先管理サービス shall 新しい取引先レコードをデータベースに作成する
7. When 取引先の作成に成功したとき, the 取引先管理サービス shall 成功メッセージを表示し、取引先一覧ページに遷移する
8. If 必須項目（名前、フリガナ、敬称、種別、住所）が未入力の場合, then the 取引先管理サービス shall バリデーションエラーメッセージを各項目に表示する
9. If メールアドレスが入力されており形式が不正な場合, then the 取引先管理サービス shall 「有効なメールアドレスを入力してください」というエラーを表示する
10. If 同一の取引先名が既に存在する場合, then the 取引先管理サービス shall 「この取引先名は既に登録されています」というエラーを表示する

### Requirement 3: 取引先詳細表示

**Objective:** As a ユーザー, I want 取引先の詳細情報を確認したい, so that 取引先の連絡先やその他の情報を把握できる

#### Acceptance Criteria

1. When ユーザーが一覧から取引先を選択したとき, the 取引先管理サービス shall 取引先詳細ページを表示する
2. The 取引先管理サービス shall 以下の情報を詳細ページに表示する: 名前、フリガナ、敬称、種別、住所、電話番号、FAX番号、メールアドレス、請求締日、支払日、備考、登録日、更新日
3. The 取引先管理サービス shall 編集ボタンと削除ボタンを詳細ページに表示する
4. Where プロジェクト管理機能が有効なとき, the 取引先管理サービス shall 当該取引先に紐付くプロジェクト一覧を表示する

### Requirement 4: 取引先編集

**Objective:** As a ユーザー, I want 取引先の情報を更新したい, so that 最新の連絡先情報や変更を反映できる

#### Acceptance Criteria

1. When ユーザーが編集ボタンをクリックしたとき, the 取引先管理サービス shall 現在の取引先情報がプリセットされた編集フォームを表示する
2. The 取引先管理サービス shall 新規作成時と同じ必須項目（名前、フリガナ、敬称、種別、住所）と任意項目（電話番号、FAX番号、メールアドレス、請求締日、支払日、備考）の編集を可能とする
3. When ユーザーが変更を保存したとき, the 取引先管理サービス shall 取引先レコードを更新する
4. When 更新に成功したとき, the 取引先管理サービス shall 成功メッセージを表示し、取引先詳細ページに遷移する
5. If 必須項目が未入力の場合, then the 取引先管理サービス shall バリデーションエラーメッセージを表示する
6. If 別の取引先と重複する取引先名に変更しようとした場合, then the 取引先管理サービス shall 「この取引先名は既に登録されています」というエラーを表示する
7. The 取引先管理サービス shall 楽観的排他制御（バージョン管理）を実装し、同時更新による競合を検出する
8. If 楽観的排他制御で競合が検出された場合, then the 取引先管理サービス shall 「他のユーザーによって更新されました。画面を更新してください」というエラーを表示する

### Requirement 5: 取引先削除

**Objective:** As a ユーザー, I want 不要になった取引先を削除したい, so that 取引先一覧を整理できる

#### Acceptance Criteria

1. When ユーザーが削除ボタンをクリックしたとき, the 取引先管理サービス shall 削除確認ダイアログを表示する
2. When ユーザーが削除を確認したとき, the 取引先管理サービス shall 取引先レコードを論理削除する
3. When 削除に成功したとき, the 取引先管理サービス shall 成功メッセージを表示し、取引先一覧ページに遷移する
4. If 取引先がプロジェクトに紐付いている場合, then the 取引先管理サービス shall 削除を拒否し、「この取引先は現在プロジェクトに使用されているため削除できません」というエラーを表示する

### Requirement 6: 取引先種別管理

**Objective:** As a システム管理者, I want 取引先種別を定義したい, so that 取引先を適切に分類できる

#### Acceptance Criteria

1. The 取引先管理サービス shall 「顧客」と「協力業者」の2種類の取引先種別をシステムで提供する
2. The 取引先管理サービス shall 取引先種別を取引先登録時の必須選択項目として提供する
3. The 取引先管理サービス shall 取引先種別の複数選択を許可し、1つの取引先が「顧客」と「協力業者」の両方であることを可能とする
4. When ユーザーが取引先を登録または編集するとき, the 取引先管理サービス shall 取引先種別をチェックボックスで選択させる

### Requirement 7: プロジェクト連携

**Objective:** As a プロジェクト管理者, I want 取引先をプロジェクトの顧客として選択したい, so that プロジェクトと顧客の関係を管理できる

#### Acceptance Criteria

1. When プロジェクト作成・編集画面で顧客を選択するとき, the 取引先管理サービス shall 取引先種別に「顧客」を含む取引先一覧を候補として提供する
2. The 取引先管理サービス shall 顧客選択時に取引先名またはフリガナで検索可能なオートコンプリート機能を提供する
3. When プロジェクトが取引先と紐付いているとき, the 取引先管理サービス shall プロジェクト詳細画面に取引先情報（名前、敬称付き表示）を表示する

### Requirement 8: アクセス制御

**Objective:** As a システム管理者, I want 取引先管理機能へのアクセスを制御したい, so that 適切な権限を持つユーザーのみが操作できる

#### Acceptance Criteria

1. The 取引先管理サービス shall 認証済みユーザーのみに取引先一覧・詳細の閲覧を許可する
2. The 取引先管理サービス shall 取引先の作成・編集・削除操作に対して適切な権限チェックを実行する
3. If 権限のないユーザーが操作を試みた場合, then the 取引先管理サービス shall 403 Forbiddenエラーを返却する
4. The 取引先管理サービス shall すべての取引先操作を監査ログに記録する

### Requirement 9: データインテグリティ

**Objective:** As a システム運用者, I want 取引先データの整合性を保ちたい, so that 信頼性の高いデータ管理を実現できる

#### Acceptance Criteria

1. The 取引先管理サービス shall 取引先名（名前）の最大文字数を200文字に制限する
2. The 取引先管理サービス shall フリガナの最大文字数を200文字に制限し、カタカナのみを許可する
3. The 取引先管理サービス shall 敬称を「御中」または「様」の2択で制限する
4. The 取引先管理サービス shall 電話番号の形式バリデーション（数字、ハイフン、括弧のみ許可）を実行する
5. The 取引先管理サービス shall FAX番号の形式バリデーション（数字、ハイフン、括弧のみ許可）を実行する
6. The 取引先管理サービス shall メールアドレスの形式バリデーションを実行する
7. The 取引先管理サービス shall 住所の最大文字数を500文字に制限する
8. The 取引先管理サービス shall 請求締日を1〜31の整数値または「末日」として管理する
9. The 取引先管理サービス shall 支払日を1〜31の整数値、「末日」、または「翌月○日」形式として管理する
10. The 取引先管理サービス shall 備考の最大文字数を2000文字に制限する
11. The 取引先管理サービス shall 各取引先レコードに作成日時と更新日時を自動記録する
