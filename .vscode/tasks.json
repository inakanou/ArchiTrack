{
  // ============================================================================
  // VS Code タスク設定
  // ============================================================================
  // 設計方針:
  // - 本質的なタスクのみ定義（冗長な個別タスクは削除）
  // - groupを活用した整理
  // - 並列実行対応
  // ============================================================================
  "version": "2.0.0",
  "tasks": [
    // ========================================================================
    // Docker 環境管理
    // ========================================================================
    {
      "label": "Docker: Dev Up",
      "type": "shell",
      "command": "npm",
      "args": ["run", "dev:docker"],
      "group": "none",
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": [],
      "detail": "開発環境のDockerコンテナを起動 (ports: 3000/5173/5432/6379)"
    },
    {
      "label": "Docker: Dev Up (Debug)",
      "type": "shell",
      "command": "docker",
      "args": [
        "compose",
        "-f",
        "docker-compose.yml",
        "-f",
        "docker-compose.dev.yml",
        "-f",
        "docker-compose.debug.yml",
        "--env-file",
        ".env.dev",
        "up",
        "-d"
      ],
      "group": "none",
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": [],
      "detail": "開発環境をデバッグモードで起動 (debugger: 9229)"
    },
    {
      "label": "Docker: Dev Down",
      "type": "shell",
      "command": "npm",
      "args": ["run", "dev:docker:down"],
      "group": "none",
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": [],
      "detail": "開発環境のDockerコンテナを停止"
    },
    {
      "label": "Docker: Test Up",
      "type": "shell",
      "command": "npm",
      "args": ["run", "test:docker"],
      "group": "none",
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": [],
      "detail": "テスト環境のDockerコンテナを起動 (ports: 3100/5174/5433/6380)"
    },
    {
      "label": "Docker: Test Down",
      "type": "shell",
      "command": "npm",
      "args": ["run", "test:docker:down"],
      "group": "none",
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": [],
      "detail": "テスト環境のDockerコンテナを停止"
    },
    {
      "label": "Docker: Ensure Test Ready",
      "type": "shell",
      "command": "${workspaceFolder}/scripts/ensure-docker-ready.sh",
      "group": "test",
      "presentation": {
        "reveal": "always",
        "panel": "shared",
        "showReuseMessage": false
      },
      "problemMatcher": [],
      "detail": "E2E/統合テスト用のDockerコンテナを起動・準備"
    },
    {
      "label": "Docker: Logs (Dev)",
      "type": "shell",
      "command": "npm",
      "args": ["run", "dev:docker:logs"],
      "group": "none",
      "presentation": {
        "reveal": "always",
        "panel": "dedicated"
      },
      "problemMatcher": [],
      "isBackground": true,
      "detail": "開発環境のDockerログをフォロー"
    },
    {
      "label": "Docker: Logs (Test)",
      "type": "shell",
      "command": "npm",
      "args": ["run", "test:docker:logs"],
      "group": "none",
      "presentation": {
        "reveal": "always",
        "panel": "dedicated"
      },
      "problemMatcher": [],
      "isBackground": true,
      "detail": "テスト環境のDockerログをフォロー"
    },
    {
      "label": "Docker: Clean All",
      "type": "shell",
      "command": "docker",
      "args": ["compose", "down", "--remove-orphans", "-v"],
      "group": "none",
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": [],
      "detail": "全Dockerコンテナとボリュームを削除"
    },

    // ========================================================================
    // 静的解析（並列実行可能）
    // ========================================================================
    {
      "label": "Check: Format (All)",
      "type": "shell",
      "command": "bash",
      "args": [
        "-c",
        "npm --prefix backend run format:check && npm --prefix frontend run format:check && npm run format:check"
      ],
      "group": "test",
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": [],
      "detail": "全プロジェクトのフォーマットチェック"
    },
    {
      "label": "Check: Type (All)",
      "type": "shell",
      "command": "bash",
      "args": [
        "-c",
        "npm --prefix backend run type-check && npm --prefix frontend run type-check && npm run type-check"
      ],
      "group": "test",
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": ["$tsc"],
      "detail": "全プロジェクトの型チェック"
    },
    {
      "label": "Check: Lint (All)",
      "type": "shell",
      "command": "bash",
      "args": [
        "-c",
        "npm --prefix backend run lint && npm --prefix frontend run lint && npm run lint"
      ],
      "group": "test",
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": ["$eslint-stylish"],
      "detail": "全プロジェクトのLintチェック"
    },
    {
      "label": "Check: Security",
      "type": "shell",
      "command": "node",
      "args": ["scripts/security-audit.mjs", "--verbose"],
      "group": "test",
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": [],
      "detail": "セキュリティ監査（本番依存のhigh以上をブロック）"
    },

    // ========================================================================
    // ビルド
    // ========================================================================
    {
      "label": "Build: Backend",
      "type": "shell",
      "command": "npm",
      "args": ["--prefix", "backend", "run", "build"],
      "group": {
        "kind": "build",
        "isDefault": false
      },
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": ["$tsc"],
      "detail": "バックエンドのビルド"
    },
    {
      "label": "Build: Frontend",
      "type": "shell",
      "command": "npm",
      "args": ["--prefix", "frontend", "run", "build"],
      "group": {
        "kind": "build",
        "isDefault": false
      },
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": ["$tsc"],
      "detail": "フロントエンドのビルド"
    },
    {
      "label": "Build: All",
      "type": "shell",
      "command": "bash",
      "args": [
        "-c",
        "npm --prefix backend run build && npm --prefix frontend run build"
      ],
      "group": {
        "kind": "build",
        "isDefault": true
      },
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": ["$tsc"],
      "detail": "全プロジェクトのビルド"
    },

    // ========================================================================
    // 単体テスト
    // 推奨: Vitest Explorer拡張機能のテストエクスプローラーを使用
    // ========================================================================
    {
      "label": "Test: Backend Unit",
      "type": "shell",
      "command": "npm",
      "args": ["--prefix", "backend", "run", "test:unit"],
      "group": "test",
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": [],
      "detail": "バックエンドの単体テスト"
    },
    {
      "label": "Test: Backend Unit (Coverage)",
      "type": "shell",
      "command": "npm",
      "args": ["--prefix", "backend", "run", "test:unit:coverage"],
      "group": "test",
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": [],
      "detail": "バックエンドの単体テスト（カバレッジ付き）"
    },
    {
      "label": "Test: Frontend Unit",
      "type": "shell",
      "command": "npm",
      "args": ["--prefix", "frontend", "run", "test"],
      "group": "test",
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": [],
      "detail": "フロントエンドの単体テスト"
    },
    {
      "label": "Test: Frontend Unit (Coverage)",
      "type": "shell",
      "command": "npm",
      "args": ["--prefix", "frontend", "run", "test:coverage"],
      "group": "test",
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": [],
      "detail": "フロントエンドの単体テスト（カバレッジ付き）"
    },
    {
      "label": "Test: All Unit (Coverage)",
      "type": "shell",
      "command": "bash",
      "args": [
        "-c",
        "npm --prefix backend run test:unit:coverage && npm --prefix frontend run test:coverage"
      ],
      "group": "test",
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": [],
      "detail": "全単体テスト（カバレッジ付き）"
    },

    // ========================================================================
    // 統合テスト
    // ========================================================================
    {
      "label": "Test: Backend Integration",
      "type": "shell",
      "command": "docker",
      "args": [
        "exec",
        "-e",
        "NODE_ENV=test",
        "architrack-backend-test",
        "npm",
        "run",
        "test:integration"
      ],
      "group": "test",
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "dependsOn": ["Docker: Ensure Test Ready"],
      "problemMatcher": [],
      "detail": "バックエンドの統合テスト（Docker環境）"
    },

    // ========================================================================
    // Storybook
    // ========================================================================
    {
      "label": "Test: Storybook",
      "type": "shell",
      "command": "npm",
      "args": ["--prefix", "frontend", "run", "test-storybook:ci"],
      "group": "test",
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": [],
      "detail": "Storybookの対話テスト"
    },
    {
      "label": "Test: Storybook Coverage",
      "type": "shell",
      "command": "npm",
      "args": ["--prefix", "frontend", "run", "storybook:coverage"],
      "group": "test",
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": [],
      "detail": "Storybookのカバレッジチェック（80%閾値）"
    },

    // ========================================================================
    // E2Eテスト
    // 推奨: Playwright Test拡張機能のテストエクスプローラーを使用
    // ========================================================================
    {
      "label": "Test: Requirement Coverage",
      "type": "shell",
      "command": "npm",
      "args": ["run", "check:req-coverage"],
      "group": "test",
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": [],
      "detail": "E2Eテストの要件カバレッジチェック"
    },
    {
      "label": "Test: E2E (Headless)",
      "type": "shell",
      "command": "npm",
      "args": ["run", "test:e2e"],
      "group": "test",
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "dependsOn": ["Docker: Ensure Test Ready"],
      "problemMatcher": [],
      "detail": "E2Eテスト（ヘッドレス）"
    },
    {
      "label": "Test: E2E (Headed)",
      "type": "shell",
      "command": "npm",
      "args": ["run", "test:e2e:headed"],
      "group": "test",
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "dependsOn": ["Docker: Ensure Test Ready"],
      "problemMatcher": [],
      "detail": "E2Eテスト（ブラウザ表示）"
    },
    {
      "label": "Test: E2E (UI Mode)",
      "type": "shell",
      "command": "npm",
      "args": ["run", "test:e2e:ui"],
      "group": "test",
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "dependsOn": ["Docker: Ensure Test Ready"],
      "problemMatcher": [],
      "detail": "E2Eテスト（UIモード）"
    },

    // ========================================================================
    // 自動修正
    // ========================================================================
    {
      "label": "Fix: Format (All)",
      "type": "shell",
      "command": "bash",
      "args": [
        "-c",
        "npm --prefix backend run format && npm --prefix frontend run format && npm run format"
      ],
      "group": "none",
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": [],
      "detail": "全プロジェクトのフォーマット自動修正"
    },
    {
      "label": "Fix: Lint (All)",
      "type": "shell",
      "command": "bash",
      "args": [
        "-c",
        "npm --prefix backend run lint:fix && npm --prefix frontend run lint:fix && npm run lint:fix"
      ],
      "group": "none",
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": ["$eslint-stylish"],
      "detail": "全プロジェクトのLint自動修正"
    },

    // ========================================================================
    // Pre-Push チェック（Git Hook相当）
    // ========================================================================
    {
      "label": "Pre-Push: Static Checks",
      "type": "shell",
      "command": "bash",
      "args": [
        "-c",
        "npm --prefix backend run format:check && npm --prefix frontend run format:check && npm run format:check && npm --prefix backend run type-check && npm --prefix frontend run type-check && npm run type-check && npm --prefix backend run lint && npm --prefix frontend run lint && npm run lint && npm --prefix backend run build && npm --prefix frontend run build && echo '✅ All static checks passed!'"
      ],
      "group": {
        "kind": "test",
        "isDefault": false
      },
      "presentation": {
        "reveal": "always",
        "panel": "shared",
        "showReuseMessage": false,
        "clear": true
      },
      "problemMatcher": ["$tsc", "$eslint-stylish"],
      "detail": "Docker不要: Format → Type → Lint → Build"
    },
    {
      "label": "Pre-Push: Full Checks",
      "type": "shell",
      "command": "bash",
      "args": ["-c", "echo '' | bash .husky/scripts/pre-push.sh"],
      "group": {
        "kind": "test",
        "isDefault": true
      },
      "presentation": {
        "reveal": "always",
        "panel": "shared",
        "showReuseMessage": false,
        "clear": true
      },
      "problemMatcher": [],
      "detail": "Git Pre-Push Hook相当の全チェック（ログ: .logs/pre-push-*.log）"
    }
  ]
}
