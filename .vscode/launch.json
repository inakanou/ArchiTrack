{
  // ============================================================================
  // VS Code デバッグ設定
  // ============================================================================
  // 設計方針:
  // - 単体テスト: Vitest Explorer拡張機能（vitest.explorer）を使用 → デバッグ構成不要
  // - E2Eテスト: Playwright Test拡張機能（ms-playwright.playwright）を使用 → デバッグ構成不要
  // - このファイルはIDE拡張機能でカバーできないケースのみ定義:
  //   サーバー起動、Dockerアタッチ、統合テスト
  // ============================================================================
  "version": "0.2.0",
  "configurations": [
    // ========================================================================
    // バックエンドサーバー
    // ========================================================================
    {
      "name": "Backend: Dev Server",
      "type": "node",
      "request": "launch",
      "runtimeExecutable": "npm",
      "runtimeArgs": ["--prefix", "backend", "run", "dev"],
      "cwd": "${workspaceFolder}",
      "console": "integratedTerminal",
      "env": {
        "NODE_ENV": "development"
      },
      "presentation": {
        "group": "1_server",
        "order": 1
      }
    },
    {
      "name": "Backend: Attach to Docker (Dev)",
      "type": "node",
      "request": "attach",
      "port": 9229,
      "address": "localhost",
      "localRoot": "${workspaceFolder}/backend",
      "remoteRoot": "/app",
      "restart": true,
      "sourceMaps": true,
      "skipFiles": ["<node_internals>/**", "**/node_modules/**"],
      "presentation": {
        "group": "1_server",
        "order": 2
      }
    },
    {
      "name": "Backend: Attach to Docker (Test)",
      "type": "node",
      "request": "attach",
      "port": 9230,
      "address": "localhost",
      "localRoot": "${workspaceFolder}/backend",
      "remoteRoot": "/app",
      "restart": true,
      "sourceMaps": true,
      "skipFiles": ["<node_internals>/**", "**/node_modules/**"],
      "presentation": {
        "group": "1_server",
        "order": 3
      }
    },

    // ========================================================================
    // 統合テスト
    // Docker環境で実行するため、IDE拡張機能ではカバーできない
    // ========================================================================
    {
      "name": "Integration: Backend (Docker)",
      "type": "node",
      "request": "launch",
      "preLaunchTask": "Docker: Ensure Test Ready",
      "runtimeExecutable": "docker",
      "runtimeArgs": [
        "exec",
        "-e", "NODE_ENV=test",
        "architrack-backend-test",
        "npm", "run", "test:integration"
      ],
      "cwd": "${workspaceFolder}",
      "console": "integratedTerminal",
      "presentation": {
        "group": "2_integration",
        "order": 1
      }
    }
  ],
  "compounds": [
    {
      "name": "Full Stack: Dev (Docker + Attach)",
      "configurations": ["Backend: Attach to Docker (Dev)"],
      "preLaunchTask": "Docker: Dev Up (Debug)",
      "stopAll": true,
      "presentation": {
        "group": "3_compound",
        "order": 1
      }
    }
  ]
}
