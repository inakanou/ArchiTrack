# Get list of staged files
STAGED_FILES=$(git diff --cached --name-only)

# Backend: TypeScript/JavaScript files
if echo "$STAGED_FILES" | grep -q '^backend/.*\.\(js\|ts\)$'; then
  echo "ğŸ” Running lint-staged on backend..."
  cd backend && npx lint-staged

  echo "ğŸ” Running TypeScript type check on backend..."
  npm run type-check
  if [ $? -ne 0 ]; then
    echo "âŒ Backend type check failed. Commit aborted."
    exit 1
  fi
  cd ..
fi

# Frontend: TypeScript/JavaScript/JSX/TSX files
if echo "$STAGED_FILES" | grep -q '^frontend/.*\.\(js\|jsx\|ts\|tsx\)$'; then
  echo "ğŸ” Running lint-staged on frontend..."
  cd frontend && npx lint-staged

  echo "ğŸ” Running TypeScript type check on frontend..."
  npm run type-check
  if [ $? -ne 0 ]; then
    echo "âŒ Frontend type check failed. Commit aborted."
    exit 1
  fi
  cd ..
fi

# E2E: TypeScript/JavaScript files
if echo "$STAGED_FILES" | grep -q '^\(e2e/.*\|playwright\.config\)\.\(js\|ts\)$'; then
  echo "ğŸ” Running lint-staged on E2E tests..."
  npx lint-staged

  echo "ğŸ” Running TypeScript type check on E2E..."
  npm run type-check
  if [ $? -ne 0 ]; then
    echo "âŒ E2E type check failed. Commit aborted."
    exit 1
  fi
fi

echo "âœ… All checks passed!"
