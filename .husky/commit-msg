# Conventional Commits形式のチェック
# 形式: type(scope?): subject
# 例: feat(backend): add user authentication
#     fix: resolve type error in index.ts
#     docs: update README

commit_msg_file=$1
commit_msg=$(cat "$commit_msg_file")

# 正規表現パターン
pattern="^(feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert)(\(.+\))?: .{1,100}"

if ! echo "$commit_msg" | grep -qE "$pattern"; then
  echo "❌ Invalid commit message format!"
  echo ""
  echo "Commit message must follow Conventional Commits format:"
  echo "  <type>[optional scope]: <description>"
  echo ""
  echo "Types:"
  echo "  feat:     新機能"
  echo "  fix:      バグ修正"
  echo "  docs:     ドキュメント"
  echo "  style:    コードスタイル（機能に影響なし）"
  echo "  refactor: リファクタリング"
  echo "  perf:     パフォーマンス改善"
  echo "  test:     テスト追加・修正"
  echo "  build:    ビルドシステム"
  echo "  ci:       CI設定"
  echo "  chore:    その他の変更"
  echo "  revert:   コミットの取り消し"
  echo ""
  echo "Examples:"
  echo "  feat(backend): add user authentication"
  echo "  fix: resolve type error in index.ts"
  echo "  docs: update TypeScript migration guide"
  echo ""
  exit 1
fi

echo "✅ Commit message format is valid"
