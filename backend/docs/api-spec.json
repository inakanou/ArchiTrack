{
  "openapi": "3.0.0",
  "info": {
    "title": "ArchiTrack API",
    "version": "1.0.0",
    "description": "ArchiTrack Backend REST API Documentation",
    "contact": {
      "name": "ArchiTrack Team"
    }
  },
  "servers": [
    {
      "url": "http://localhost:3000",
      "description": "Development server"
    },
    {
      "url": "https://api.architrack.com",
      "description": "Production server"
    }
  ],
  "components": {
    "securitySchemes": {
      "BearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT",
        "description": "JWT authentication token"
      }
    },
    "schemas": {
      "UserRef": {
        "type": "object",
        "description": "User reference with id and display name",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid",
            "description": "User ID"
          },
          "displayName": {
            "type": "string",
            "description": "User display name"
          }
        }
      },
      "ProjectStatus": {
        "type": "string",
        "description": "Project status enum",
        "enum": [
          "PREPARING",
          "SURVEYING",
          "ESTIMATING",
          "APPROVING",
          "CONTRACTING",
          "CONSTRUCTING",
          "DELIVERING",
          "BILLING",
          "AWAITING",
          "COMPLETED",
          "CANCELLED",
          "LOST"
        ]
      },
      "TransitionType": {
        "type": "string",
        "description": "Status transition type",
        "enum": [
          "initial",
          "forward",
          "backward",
          "terminate"
        ]
      },
      "PaginationInfo": {
        "type": "object",
        "description": "Pagination metadata",
        "properties": {
          "page": {
            "type": "integer",
            "description": "Current page number",
            "example": 1
          },
          "limit": {
            "type": "integer",
            "description": "Items per page",
            "example": 20
          },
          "total": {
            "type": "integer",
            "description": "Total number of items",
            "example": 100
          },
          "totalPages": {
            "type": "integer",
            "description": "Total number of pages",
            "example": 5
          }
        }
      },
      "ProjectInfo": {
        "type": "object",
        "description": "Project summary information",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid",
            "description": "Project ID"
          },
          "name": {
            "type": "string",
            "description": "Project name",
            "example": "New Construction Project"
          },
          "customerName": {
            "type": "string",
            "description": "Customer name",
            "example": "ABC Corporation"
          },
          "salesPerson": {
            "$ref": "#/components/schemas/UserRef"
          },
          "constructionPerson": {
            "$ref": "#/components/schemas/UserRef"
          },
          "siteAddress": {
            "type": "string",
            "nullable": true,
            "description": "Site address",
            "example": "Tokyo, Chiyoda-ku"
          },
          "description": {
            "type": "string",
            "nullable": true,
            "description": "Project description"
          },
          "status": {
            "$ref": "#/components/schemas/ProjectStatus"
          },
          "statusLabel": {
            "type": "string",
            "description": "Status display label",
            "example": "Preparing"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time",
            "description": "Creation timestamp"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time",
            "description": "Last update timestamp"
          }
        }
      },
      "ProjectDetail": {
        "type": "object",
        "description": "Project detailed information",
        "allOf": [
          {
            "$ref": "#/components/schemas/ProjectInfo"
          },
          {
            "type": "object",
            "properties": {
              "createdBy": {
                "$ref": "#/components/schemas/UserRef"
              }
            }
          }
        ]
      },
      "CreateProjectRequest": {
        "type": "object",
        "description": "Request body for creating a project",
        "required": [
          "name",
          "customerName",
          "salesPersonId"
        ],
        "properties": {
          "name": {
            "type": "string",
            "description": "Project name (1-255 characters)",
            "minLength": 1,
            "maxLength": 255,
            "example": "New Construction Project"
          },
          "customerName": {
            "type": "string",
            "description": "Customer name (1-255 characters)",
            "minLength": 1,
            "maxLength": 255,
            "example": "ABC Corporation"
          },
          "salesPersonId": {
            "type": "string",
            "format": "uuid",
            "description": "Sales person user ID"
          },
          "constructionPersonId": {
            "type": "string",
            "format": "uuid",
            "nullable": true,
            "description": "Construction person user ID (optional)"
          },
          "siteAddress": {
            "type": "string",
            "maxLength": 500,
            "nullable": true,
            "description": "Site address (optional, max 500 characters)"
          },
          "description": {
            "type": "string",
            "maxLength": 2000,
            "nullable": true,
            "description": "Project description (optional, max 2000 characters)"
          }
        }
      },
      "UpdateProjectRequest": {
        "type": "object",
        "description": "Request body for updating a project (with optimistic locking)",
        "required": [
          "expectedUpdatedAt"
        ],
        "properties": {
          "name": {
            "type": "string",
            "description": "Project name (1-255 characters)",
            "minLength": 1,
            "maxLength": 255
          },
          "customerName": {
            "type": "string",
            "description": "Customer name (1-255 characters)",
            "minLength": 1,
            "maxLength": 255
          },
          "salesPersonId": {
            "type": "string",
            "format": "uuid",
            "description": "Sales person user ID"
          },
          "constructionPersonId": {
            "type": "string",
            "format": "uuid",
            "nullable": true,
            "description": "Construction person user ID"
          },
          "siteAddress": {
            "type": "string",
            "maxLength": 500,
            "nullable": true,
            "description": "Site address"
          },
          "description": {
            "type": "string",
            "maxLength": 2000,
            "nullable": true,
            "description": "Project description"
          },
          "expectedUpdatedAt": {
            "type": "string",
            "format": "date-time",
            "description": "Expected updatedAt for optimistic locking"
          }
        }
      },
      "StatusHistory": {
        "type": "object",
        "description": "Project status change history entry",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid",
            "description": "History entry ID"
          },
          "projectId": {
            "type": "string",
            "format": "uuid",
            "description": "Project ID"
          },
          "fromStatus": {
            "type": "string",
            "nullable": true,
            "description": "Previous status (null for initial)"
          },
          "toStatus": {
            "type": "string",
            "description": "New status"
          },
          "transitionType": {
            "$ref": "#/components/schemas/TransitionType"
          },
          "reason": {
            "type": "string",
            "nullable": true,
            "description": "Reason for transition (required for backward)"
          },
          "changedById": {
            "type": "string",
            "format": "uuid",
            "description": "User who made the change"
          },
          "changedAt": {
            "type": "string",
            "format": "date-time",
            "description": "Timestamp of the change"
          },
          "changedBy": {
            "$ref": "#/components/schemas/UserRef"
          }
        }
      }
    },
    "responses": {
      "BadRequest": {
        "description": "Bad Request - Invalid parameters",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "error": {
                  "type": "string"
                },
                "code": {
                  "type": "string"
                },
                "details": {
                  "type": "object"
                }
              }
            }
          }
        }
      },
      "Unauthorized": {
        "description": "Unauthorized - Authentication required",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "error": {
                  "type": "string"
                }
              }
            }
          }
        }
      },
      "Forbidden": {
        "description": "Forbidden - Insufficient permissions",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "error": {
                  "type": "string"
                }
              }
            }
          }
        }
      },
      "NotFound": {
        "description": "Not Found",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "error": {
                  "type": "string"
                }
              }
            }
          }
        }
      },
      "InternalServerError": {
        "description": "Internal Server Error",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "error": {
                  "type": "string"
                },
                "requestId": {
                  "type": "string"
                }
              }
            }
          }
        }
      },
      "Conflict": {
        "description": "Conflict - Resource was modified by another user (optimistic locking)",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "type": {
                  "type": "string",
                  "description": "Problem type URI"
                },
                "title": {
                  "type": "string",
                  "description": "Problem title",
                  "example": "Conflict"
                },
                "status": {
                  "type": "integer",
                  "description": "HTTP status code",
                  "example": 409
                },
                "detail": {
                  "type": "string",
                  "description": "Detailed error message"
                },
                "code": {
                  "type": "string",
                  "description": "Error code",
                  "example": "PROJECT_CONFLICT"
                },
                "expectedUpdatedAt": {
                  "type": "string",
                  "format": "date-time",
                  "description": "Expected updatedAt timestamp"
                },
                "actualUpdatedAt": {
                  "type": "string",
                  "format": "date-time",
                  "description": "Actual updatedAt timestamp"
                }
              }
            }
          }
        }
      },
      "UnprocessableEntity": {
        "description": "Unprocessable Entity - Invalid status transition or missing required data",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "type": {
                  "type": "string",
                  "description": "Problem type URI"
                },
                "title": {
                  "type": "string",
                  "description": "Problem title",
                  "example": "Invalid Status Transition"
                },
                "status": {
                  "type": "integer",
                  "description": "HTTP status code",
                  "example": 422
                },
                "detail": {
                  "type": "string",
                  "description": "Detailed error message"
                },
                "code": {
                  "type": "string",
                  "description": "Error code",
                  "example": "INVALID_STATUS_TRANSITION"
                },
                "fromStatus": {
                  "type": "string",
                  "description": "Current status"
                },
                "toStatus": {
                  "type": "string",
                  "description": "Requested status"
                },
                "allowed": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  },
                  "description": "List of allowed transitions"
                }
              }
            }
          }
        }
      }
    }
  },
  "tags": [
    {
      "name": "Health",
      "description": "Health check endpoints"
    },
    {
      "name": "Admin",
      "description": "Administrative endpoints"
    },
    {
      "name": "Authentication",
      "description": "User authentication endpoints (register, login, logout, token refresh)"
    },
    {
      "name": "Two-Factor Authentication",
      "description": "2FA setup, verification, and backup code management"
    },
    {
      "name": "Password Management",
      "description": "Password reset and recovery endpoints"
    },
    {
      "name": "Roles",
      "description": "Role management endpoints (RBAC)"
    },
    {
      "name": "Permissions",
      "description": "Permission management endpoints (RBAC)"
    },
    {
      "name": "Users",
      "description": "User management endpoints"
    },
    {
      "name": "Invitations",
      "description": "User invitation and onboarding endpoints"
    },
    {
      "name": "Audit Logs",
      "description": "System audit log endpoints"
    },
    {
      "name": "Projects",
      "description": "Project management endpoints"
    }
  ],
  "paths": {
    "/health": {
      "get": {
        "summary": "Health check",
        "description": "Check the health status of the API and its dependencies (Database, Redis)",
        "tags": [
          "Health"
        ],
        "responses": {
          "200": {
            "description": "Server is healthy",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "example": "ok"
                    },
                    "timestamp": {
                      "type": "string",
                      "format": "date-time"
                    },
                    "services": {
                      "type": "object",
                      "properties": {
                        "database": {
                          "type": "string",
                          "enum": [
                            "connected",
                            "disconnected"
                          ]
                        },
                        "redis": {
                          "type": "string",
                          "enum": [
                            "connected",
                            "disconnected"
                          ]
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/csrf-token": {
      "get": {
        "summary": "Get CSRF Token",
        "description": "Generate and return a CSRF token for subsequent state-changing requests",
        "tags": [
          "Security"
        ],
        "responses": {
          "200": {
            "description": "CSRF token generated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "csrfToken": {
                      "type": "string",
                      "example": "a1b2c3d4e5f6..."
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api": {
      "get": {
        "summary": "API Information",
        "description": "Returns API version and basic information",
        "tags": [
          "Health"
        ],
        "responses": {
          "200": {
            "description": "API information",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "ArchiTrack API"
                    },
                    "version": {
                      "type": "string",
                      "example": "1.0.0"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/admin/log-level": {
      "post": {
        "summary": "Change log level",
        "description": "Change the application's log level. Requires authentication in production.",
        "tags": [
          "Admin"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "level"
                ],
                "properties": {
                  "level": {
                    "type": "string",
                    "enum": [
                      "trace",
                      "debug",
                      "info",
                      "warn",
                      "error",
                      "fatal"
                    ],
                    "description": "The log level to set"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Log level changed successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "level": {
                      "type": "string",
                      "example": "debug"
                    },
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          }
        }
      },
      "get": {
        "summary": "Get current log level",
        "description": "Retrieve the current application log level and environment",
        "tags": [
          "Admin"
        ],
        "responses": {
          "200": {
            "description": "Current log level retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "level": {
                      "type": "string",
                      "example": "info"
                    },
                    "environment": {
                      "type": "string",
                      "enum": [
                        "development",
                        "production"
                      ],
                      "example": "development"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/site-surveys/images/{imageId}/annotations": {
      "get": {
        "summary": "注釈データ取得",
        "description": "画像に関連付けられた注釈データを取得する",
        "tags": [
          "Annotations"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "imageId",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "画像ID"
          }
        ],
        "responses": {
          "200": {
            "description": "注釈データ取得成功（注釈が存在しない場合はdata: nullを返す）",
            "content": {
              "application/json": {
                "schema": {
                  "oneOf": [
                    {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string",
                          "format": "uuid"
                        },
                        "imageId": {
                          "type": "string",
                          "format": "uuid"
                        },
                        "data": {
                          "type": "object"
                        },
                        "version": {
                          "type": "string"
                        },
                        "createdAt": {
                          "type": "string",
                          "format": "date-time"
                        },
                        "updatedAt": {
                          "type": "string",
                          "format": "date-time"
                        }
                      }
                    },
                    {
                      "type": "object",
                      "properties": {
                        "data": {
                          "type": null
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "400": {
            "description": "無効な画像ID形式"
          },
          "401": {
            "description": "認証エラー"
          },
          "403": {
            "description": "権限不足"
          },
          "404": {
            "description": "画像が見つからない"
          }
        }
      },
      "put": {
        "summary": "注釈データ保存",
        "description": "画像に注釈データを保存する（新規作成または更新）",
        "tags": [
          "Annotations"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "imageId",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "画像ID"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "data"
                ],
                "properties": {
                  "data": {
                    "type": "object",
                    "required": [
                      "objects"
                    ],
                    "properties": {
                      "version": {
                        "type": "string"
                      },
                      "objects": {
                        "type": "array",
                        "items": {
                          "type": "object"
                        }
                      },
                      "background": {
                        "type": "string"
                      },
                      "viewportTransform": {
                        "type": "array",
                        "items": {
                          "type": "number"
                        }
                      }
                    }
                  },
                  "expectedUpdatedAt": {
                    "type": "string",
                    "format": "date-time",
                    "description": "楽観的排他制御用の期待される更新日時"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "注釈データ保存成功"
          },
          "400": {
            "description": "バリデーションエラーまたは無効な注釈データ形式"
          },
          "401": {
            "description": "認証エラー"
          },
          "403": {
            "description": "権限不足"
          },
          "404": {
            "description": "画像が見つからない"
          },
          "409": {
            "description": "楽観的排他制御エラー（競合）"
          }
        }
      }
    },
    "/api/site-surveys/images/{imageId}/annotations/export": {
      "get": {
        "summary": "注釈データJSONエクスポート",
        "description": "注釈データをJSONファイルとしてエクスポートする",
        "tags": [
          "Annotations"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "imageId",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "画像ID"
          }
        ],
        "responses": {
          "200": {
            "description": "JSONエクスポート成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object"
                }
              }
            }
          },
          "400": {
            "description": "無効な画像ID形式"
          },
          "401": {
            "description": "認証エラー"
          },
          "403": {
            "description": "権限不足"
          },
          "404": {
            "description": "画像または注釈データが見つからない"
          }
        }
      }
    },
    "/api/v1/audit-logs": {
      "get": {
        "summary": "監査ログ取得",
        "description": "監査ログを取得（フィルタリング対応）",
        "tags": [
          "Audit Logs"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "query",
            "name": "actorId",
            "schema": {
              "type": "string"
            },
            "description": "実行者ユーザーID"
          },
          {
            "in": "query",
            "name": "targetId",
            "schema": {
              "type": "string"
            },
            "description": "対象リソースID"
          },
          {
            "in": "query",
            "name": "action",
            "schema": {
              "type": "string"
            },
            "description": "アクション種別"
          },
          {
            "in": "query",
            "name": "startDate",
            "schema": {
              "type": "string",
              "format": "date-time"
            },
            "description": "開始日時（ISO 8601形式）"
          },
          {
            "in": "query",
            "name": "endDate",
            "schema": {
              "type": "string",
              "format": "date-time"
            },
            "description": "終了日時（ISO 8601形式）"
          },
          {
            "in": "query",
            "name": "skip",
            "schema": {
              "type": "integer"
            },
            "description": "スキップ数"
          },
          {
            "in": "query",
            "name": "take",
            "schema": {
              "type": "integer"
            },
            "description": "取得件数"
          }
        ],
        "responses": {
          "200": {
            "description": "監査ログ一覧"
          },
          "401": {
            "description": "認証エラー"
          },
          "403": {
            "description": "権限不足"
          }
        }
      }
    },
    "/api/v1/audit-logs/export": {
      "get": {
        "summary": "監査ログエクスポート",
        "description": "監査ログをJSON形式でエクスポート",
        "tags": [
          "Audit Logs"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "query",
            "name": "actorId",
            "schema": {
              "type": "string"
            },
            "description": "実行者ユーザーID"
          },
          {
            "in": "query",
            "name": "targetId",
            "schema": {
              "type": "string"
            },
            "description": "対象リソースID"
          },
          {
            "in": "query",
            "name": "action",
            "schema": {
              "type": "string"
            },
            "description": "アクション種別"
          },
          {
            "in": "query",
            "name": "startDate",
            "schema": {
              "type": "string",
              "format": "date-time"
            },
            "description": "開始日時（ISO 8601形式）"
          },
          {
            "in": "query",
            "name": "endDate",
            "schema": {
              "type": "string",
              "format": "date-time"
            },
            "description": "終了日時（ISO 8601形式）"
          }
        ],
        "responses": {
          "200": {
            "description": "JSON形式の監査ログ",
            "content": {
              "application/json": {
                "schema": {
                  "type": "string"
                }
              }
            }
          },
          "401": {
            "description": "認証エラー"
          },
          "403": {
            "description": "権限不足"
          }
        }
      }
    },
    "/api/v1/auth/register": {
      "post": {
        "summary": "Register a new user",
        "description": "Register a new user using a valid invitation token",
        "tags": [
          "Authentication"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "invitationToken",
                  "displayName",
                  "password"
                ],
                "properties": {
                  "invitationToken": {
                    "type": "string",
                    "description": "Valid invitation token",
                    "example": "abc123def456"
                  },
                  "displayName": {
                    "type": "string",
                    "description": "User's display name",
                    "example": "John Doe"
                  },
                  "password": {
                    "type": "string",
                    "format": "password",
                    "description": "User password (min 12 characters, complexity requirements)",
                    "example": "SecurePassword123!"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "User registered successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "accessToken": {
                      "type": "string"
                    },
                    "refreshToken": {
                      "type": "string"
                    },
                    "user": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "email": {
                          "type": "string"
                        },
                        "displayName": {
                          "type": "string"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "$ref": "#/components/responses/BadRequest"
          }
        }
      }
    },
    "/api/v1/auth/login": {
      "post": {
        "summary": "Login",
        "description": "Authenticate a user and return access and refresh tokens",
        "tags": [
          "Authentication"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "email",
                  "password"
                ],
                "properties": {
                  "email": {
                    "type": "string",
                    "format": "email",
                    "example": "user@example.com"
                  },
                  "password": {
                    "type": "string",
                    "format": "password",
                    "example": "SecurePassword123!"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Login successful",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "accessToken": {
                      "type": "string"
                    },
                    "refreshToken": {
                      "type": "string"
                    },
                    "user": {
                      "type": "object",
                      "properties": {
                        "id": {
                          "type": "string"
                        },
                        "email": {
                          "type": "string"
                        },
                        "displayName": {
                          "type": "string"
                        }
                      }
                    },
                    "requires2FA": {
                      "type": "boolean",
                      "description": "True if 2FA is required"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          }
        }
      }
    },
    "/api/v1/auth/refresh": {
      "post": {
        "summary": "Refresh access token",
        "description": "Get a new access token using a valid refresh token",
        "tags": [
          "Authentication"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "refreshToken"
                ],
                "properties": {
                  "refreshToken": {
                    "type": "string",
                    "description": "Valid refresh token"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Token refreshed successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "accessToken": {
                      "type": "string"
                    },
                    "refreshToken": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          }
        }
      }
    },
    "/api/v1/auth/me": {
      "get": {
        "summary": "Get current user",
        "description": "Get the current authenticated user's information",
        "tags": [
          "Authentication"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "User information retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "string"
                    },
                    "email": {
                      "type": "string"
                    },
                    "displayName": {
                      "type": "string"
                    },
                    "roles": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "name": {
                            "type": "string"
                          },
                          "description": {
                            "type": "string"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          }
        }
      },
      "patch": {
        "summary": "Update user profile",
        "description": "Update the current authenticated user's profile information",
        "tags": [
          "Authentication"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "displayName": {
                    "type": "string",
                    "description": "Updated display name",
                    "example": "John Smith"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Profile updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "string"
                    },
                    "email": {
                      "type": "string"
                    },
                    "displayName": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          }
        }
      }
    },
    "/api/v1/auth/logout": {
      "post": {
        "summary": "Logout",
        "description": "Logout the current user from the current device",
        "tags": [
          "Authentication"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "refreshToken"
                ],
                "properties": {
                  "refreshToken": {
                    "type": "string",
                    "description": "Refresh token to invalidate"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Logged out successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          }
        }
      }
    },
    "/api/v1/auth/logout-all": {
      "post": {
        "summary": "Logout from all devices",
        "description": "Logout the current user from all devices",
        "tags": [
          "Authentication"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Logged out from all devices successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          }
        }
      }
    },
    "/api/v1/auth/verify-2fa": {
      "post": {
        "summary": "Verify 2FA token",
        "description": "Verify a TOTP token for two-factor authentication",
        "tags": [
          "Authentication"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "token"
                ],
                "properties": {
                  "token": {
                    "type": "string",
                    "description": "6-digit TOTP token",
                    "example": "123456"
                  },
                  "email": {
                    "type": "string",
                    "format": "email",
                    "description": "Email (for login flow)"
                  },
                  "tempToken": {
                    "type": "string",
                    "description": "Temporary token from login"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "2FA verification successful",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "accessToken": {
                      "type": "string"
                    },
                    "refreshToken": {
                      "type": "string"
                    },
                    "user": {
                      "type": "object"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          }
        }
      }
    },
    "/api/v1/auth/verify-2fa/backup": {
      "post": {
        "summary": "Verify 2FA backup code",
        "description": "Verify a backup code for two-factor authentication",
        "tags": [
          "Authentication"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "backupCode",
                  "email"
                ],
                "properties": {
                  "backupCode": {
                    "type": "string",
                    "description": "8-character backup code",
                    "example": "ABCD1234"
                  },
                  "email": {
                    "type": "string",
                    "format": "email",
                    "description": "Email (for login flow)"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "2FA verification successful",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "accessToken": {
                      "type": "string"
                    },
                    "refreshToken": {
                      "type": "string"
                    },
                    "user": {
                      "type": "object"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          }
        }
      }
    },
    "/api/v1/auth/2fa/setup": {
      "post": {
        "summary": "2FA設定開始",
        "description": "TOTP秘密鍵、QRコード、バックアップコードを生成して返す",
        "tags": [
          "Two-Factor Authentication"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "2FA設定データ生成成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "secret": {
                      "type": "string",
                      "description": "Base32エンコード済みTOTP秘密鍵"
                    },
                    "qrCodeDataUrl": {
                      "type": "string",
                      "description": "QRコード（Data URL形式）"
                    },
                    "backupCodes": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "description": "10個のバックアップコード"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "既に2FAが有効化されている"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          }
        }
      }
    },
    "/api/v1/auth/2fa/enable": {
      "post": {
        "summary": "2FA有効化",
        "description": "TOTPコードを検証して2FAを有効化する",
        "tags": [
          "Two-Factor Authentication"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "totpCode"
                ],
                "properties": {
                  "totpCode": {
                    "type": "string",
                    "description": "6桁のTOTPコード",
                    "example": "123456"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "2FA有効化成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "backupCodes": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "description": "バックアップコード（最後の表示機会）"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "無効なTOTPコード"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          }
        }
      }
    },
    "/api/v1/auth/2fa/disable": {
      "post": {
        "summary": "2FA無効化",
        "description": "パスワードを確認して2FAを無効化する",
        "tags": [
          "Two-Factor Authentication"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "password"
                ],
                "properties": {
                  "password": {
                    "type": "string",
                    "format": "password",
                    "description": "ユーザーの現在のパスワード"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "2FA無効化成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "2FA disabled successfully"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "無効なパスワードまたは2FAが未有効化"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          }
        }
      }
    },
    "/api/v1/auth/2fa/backup-codes/regenerate": {
      "post": {
        "summary": "バックアップコード再生成",
        "description": "既存のバックアップコードを削除して新しいコードを生成する",
        "tags": [
          "Two-Factor Authentication"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "バックアップコード再生成成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "backupCodes": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "description": "10個の新しいバックアップコード"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "2FAが未有効化"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          }
        }
      }
    },
    "/api/v1/auth/2fa/backup-codes": {
      "get": {
        "summary": "バックアップコードステータス一覧取得",
        "description": "現在のバックアップコードの使用状況を取得する",
        "tags": [
          "Two-Factor Authentication"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "バックアップコードステータス取得成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "backupCodes": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "code": {
                            "type": "string",
                            "description": "マスク表示用のコード（****-0001形式）"
                          },
                          "isUsed": {
                            "type": "boolean",
                            "description": "使用済みフラグ"
                          },
                          "usedAt": {
                            "type": "string",
                            "nullable": true,
                            "description": "使用日時（ISO 8601形式）"
                          }
                        }
                      }
                    },
                    "remainingCount": {
                      "type": "number",
                      "description": "未使用コード数"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "2FAが未有効化"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          }
        }
      }
    },
    "/api/v1/auth/password/reset-request": {
      "post": {
        "summary": "Request password reset",
        "description": "Request a password reset email with a reset token",
        "tags": [
          "Authentication"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "email"
                ],
                "properties": {
                  "email": {
                    "type": "string",
                    "format": "email",
                    "description": "User email address",
                    "example": "user@example.com"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Password reset email sent (always returns 200 for security)",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "If an account exists, a password reset email has been sent"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Validation error"
          }
        }
      }
    },
    "/api/v1/auth/password/verify-reset": {
      "get": {
        "summary": "Verify password reset token",
        "description": "Verify if a password reset token is valid and not expired",
        "tags": [
          "Authentication"
        ],
        "parameters": [
          {
            "in": "query",
            "name": "token",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "Password reset token"
          }
        ],
        "responses": {
          "200": {
            "description": "Token is valid",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "valid": {
                      "type": "boolean",
                      "example": true
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid or expired token"
          }
        }
      }
    },
    "/api/v1/auth/password/reset": {
      "post": {
        "summary": "Reset password",
        "description": "Reset user password using a valid reset token",
        "tags": [
          "Authentication"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "token",
                  "newPassword"
                ],
                "properties": {
                  "token": {
                    "type": "string",
                    "description": "Password reset token",
                    "example": "abc123def456"
                  },
                  "newPassword": {
                    "type": "string",
                    "format": "password",
                    "description": "New password (min 12 characters, complexity requirements)",
                    "example": "NewSecurePassword123!"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Password reset successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string",
                      "example": "Password reset successfully"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid token or weak password"
          }
        }
      }
    },
    "/api/v1/auth/password/change": {
      "post": {
        "summary": "Change password",
        "description": "Change the password for the authenticated user",
        "tags": [
          "Authentication"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "currentPassword",
                  "newPassword",
                  "newPasswordConfirm"
                ],
                "properties": {
                  "currentPassword": {
                    "type": "string",
                    "description": "Current password"
                  },
                  "newPassword": {
                    "type": "string",
                    "description": "New password (min 12 characters)"
                  },
                  "newPasswordConfirm": {
                    "type": "string",
                    "description": "New password confirmation"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Password changed successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid request (weak password, password mismatch, etc.)"
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          }
        }
      }
    },
    "/api/v1/invitations": {
      "post": {
        "summary": "招待を作成",
        "tags": [
          "Invitations"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "email": {
                    "type": "string",
                    "format": "email",
                    "example": "newuser@example.com"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "招待作成成功"
          },
          "400": {
            "description": "バリデーションエラー"
          },
          "403": {
            "description": "権限不足"
          },
          "409": {
            "description": "メールアドレスが既に登録済み"
          }
        }
      },
      "get": {
        "summary": "招待一覧を取得",
        "tags": [
          "Invitations"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "query",
            "name": "status",
            "schema": {
              "type": "string",
              "enum": [
                "pending",
                "used",
                "expired",
                "revoked"
              ]
            },
            "description": "招待ステータスでフィルタリング"
          }
        ],
        "responses": {
          "200": {
            "description": "招待一覧取得成功"
          },
          "403": {
            "description": "権限不足"
          }
        }
      }
    },
    "/api/v1/invitations/{id}": {
      "delete": {
        "summary": "招待を取り消す",
        "tags": [
          "Invitations"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "招待ID"
          }
        ],
        "responses": {
          "204": {
            "description": "招待取り消し成功"
          },
          "403": {
            "description": "権限不足"
          },
          "404": {
            "description": "招待が見つかりません"
          }
        }
      }
    },
    "/api/v1/invitations/verify": {
      "get": {
        "summary": "招待トークンを検証",
        "tags": [
          "Invitations"
        ],
        "parameters": [
          {
            "in": "query",
            "name": "token",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "招待トークン"
          }
        ],
        "responses": {
          "200": {
            "description": "トークン検証成功"
          },
          "400": {
            "description": "トークンが無効、期限切れ、または使用済み"
          }
        }
      }
    },
    "/api/v1/permissions": {
      "get": {
        "summary": "権限一覧取得",
        "description": "全ての権限を取得（リソース・アクション順でソート）",
        "tags": [
          "Permissions"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "権限一覧",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "id": {
                        "type": "string",
                        "example": "permission-1"
                      },
                      "resource": {
                        "type": "string",
                        "example": "adr"
                      },
                      "action": {
                        "type": "string",
                        "example": "read"
                      },
                      "description": {
                        "type": "string",
                        "example": "View ADRs"
                      },
                      "createdAt": {
                        "type": "string",
                        "format": "date-time"
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "認証エラー"
          },
          "403": {
            "description": "権限不足"
          }
        }
      }
    },
    "/api/projects": {
      "get": {
        "summary": "プロジェクト一覧取得",
        "description": "ページネーション、検索、フィルタリング、ソートに対応したプロジェクト一覧を取得",
        "tags": [
          "Projects"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "query",
            "name": "page",
            "schema": {
              "type": "integer",
              "default": 1
            },
            "description": "ページ番号（1以上）"
          },
          {
            "in": "query",
            "name": "limit",
            "schema": {
              "type": "integer",
              "default": 20,
              "maximum": 100
            },
            "description": "1ページあたりの表示件数（1〜100）"
          },
          {
            "in": "query",
            "name": "search",
            "schema": {
              "type": "string"
            },
            "description": "検索キーワード（プロジェクト名・取引先名の部分一致、2文字以上）"
          },
          {
            "in": "query",
            "name": "status",
            "schema": {
              "type": "string"
            },
            "description": "ステータスフィルタ（カンマ区切りで複数指定可）"
          },
          {
            "in": "query",
            "name": "createdFrom",
            "schema": {
              "type": "string",
              "format": "date"
            },
            "description": "作成日開始（ISO8601形式）"
          },
          {
            "in": "query",
            "name": "createdTo",
            "schema": {
              "type": "string",
              "format": "date"
            },
            "description": "作成日終了（ISO8601形式）"
          },
          {
            "in": "query",
            "name": "sort",
            "schema": {
              "type": "string",
              "enum": [
                "id",
                "name",
                "tradingPartnerId",
                "status",
                "createdAt",
                "updatedAt"
              ],
              "default": "updatedAt"
            },
            "description": "ソートフィールド"
          },
          {
            "in": "query",
            "name": "order",
            "schema": {
              "type": "string",
              "enum": [
                "asc",
                "desc"
              ],
              "default": "desc"
            },
            "description": "ソート順序"
          }
        ],
        "responses": {
          "200": {
            "description": "プロジェクト一覧",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/ProjectInfo"
                      }
                    },
                    "pagination": {
                      "$ref": "#/components/schemas/PaginationInfo"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "バリデーションエラー"
          },
          "401": {
            "description": "認証エラー"
          },
          "403": {
            "description": "権限不足"
          }
        }
      },
      "post": {
        "summary": "プロジェクト作成",
        "description": "新しいプロジェクトを作成",
        "tags": [
          "Projects"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateProjectRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "プロジェクト作成成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProjectInfo"
                }
              }
            }
          },
          "400": {
            "description": "バリデーションエラー"
          },
          "401": {
            "description": "認証エラー"
          },
          "403": {
            "description": "権限不足"
          }
        }
      }
    },
    "/api/projects/{id}": {
      "get": {
        "summary": "プロジェクト詳細取得",
        "description": "指定されたIDのプロジェクト詳細を取得",
        "tags": [
          "Projects"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "プロジェクトID"
          }
        ],
        "responses": {
          "200": {
            "description": "プロジェクト詳細",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProjectDetail"
                }
              }
            }
          },
          "400": {
            "description": "無効なプロジェクトID形式"
          },
          "401": {
            "description": "認証エラー"
          },
          "403": {
            "description": "権限不足"
          },
          "404": {
            "description": "プロジェクトが見つからない"
          }
        }
      },
      "put": {
        "summary": "プロジェクト更新",
        "description": "既存のプロジェクト情報を更新（楽観的排他制御）",
        "tags": [
          "Projects"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "プロジェクトID"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateProjectRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "プロジェクト更新成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProjectInfo"
                }
              }
            }
          },
          "400": {
            "description": "バリデーションエラー"
          },
          "401": {
            "description": "認証エラー"
          },
          "403": {
            "description": "権限不足"
          },
          "404": {
            "description": "プロジェクトが見つからない"
          },
          "409": {
            "description": "楽観的排他制御エラー（競合）"
          }
        }
      },
      "delete": {
        "summary": "プロジェクト削除",
        "description": "プロジェクトを論理削除",
        "tags": [
          "Projects"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "プロジェクトID"
          }
        ],
        "responses": {
          "204": {
            "description": "プロジェクト削除成功"
          },
          "400": {
            "description": "無効なプロジェクトID形式"
          },
          "401": {
            "description": "認証エラー"
          },
          "403": {
            "description": "権限不足"
          },
          "404": {
            "description": "プロジェクトが見つからない"
          }
        }
      }
    },
    "/api/projects/{id}/status": {
      "patch": {
        "summary": "プロジェクトステータス変更",
        "description": "プロジェクトのステータスを変更（遷移ルールに従う）",
        "tags": [
          "Projects"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "プロジェクトID"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "status"
                ],
                "properties": {
                  "status": {
                    "type": "string",
                    "enum": [
                      "PREPARING",
                      "SURVEYING",
                      "ESTIMATING",
                      "APPROVING",
                      "CONTRACTING",
                      "CONSTRUCTING",
                      "DELIVERING",
                      "BILLING",
                      "AWAITING",
                      "COMPLETED",
                      "CANCELLED",
                      "LOST"
                    ],
                    "description": "新しいステータス"
                  },
                  "reason": {
                    "type": "string",
                    "description": "差し戻し理由（backward遷移時は必須）"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "ステータス変更成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "string",
                      "format": "uuid"
                    },
                    "name": {
                      "type": "string"
                    },
                    "status": {
                      "type": "string"
                    },
                    "updatedAt": {
                      "type": "string",
                      "format": "date-time"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "バリデーションエラー"
          },
          "401": {
            "description": "認証エラー"
          },
          "403": {
            "description": "権限不足"
          },
          "404": {
            "description": "プロジェクトが見つからない"
          },
          "422": {
            "description": "無効なステータス遷移または差し戻し理由未入力"
          }
        }
      }
    },
    "/api/projects/{id}/status-history": {
      "get": {
        "summary": "ステータス変更履歴取得",
        "description": "プロジェクトのステータス変更履歴を取得",
        "tags": [
          "Projects"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "プロジェクトID"
          }
        ],
        "responses": {
          "200": {
            "description": "ステータス変更履歴",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "id": {
                        "type": "string",
                        "format": "uuid"
                      },
                      "projectId": {
                        "type": "string",
                        "format": "uuid"
                      },
                      "fromStatus": {
                        "type": "string",
                        "nullable": true
                      },
                      "toStatus": {
                        "type": "string"
                      },
                      "transitionType": {
                        "type": "string",
                        "enum": [
                          "initial",
                          "forward",
                          "backward",
                          "terminate"
                        ]
                      },
                      "reason": {
                        "type": "string",
                        "nullable": true
                      },
                      "changedById": {
                        "type": "string",
                        "format": "uuid"
                      },
                      "changedAt": {
                        "type": "string",
                        "format": "date-time"
                      },
                      "changedBy": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string",
                            "format": "uuid"
                          },
                          "displayName": {
                            "type": "string"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "無効なプロジェクトID形式"
          },
          "401": {
            "description": "認証エラー"
          },
          "403": {
            "description": "権限不足"
          },
          "404": {
            "description": "プロジェクトが見つからない"
          }
        }
      }
    },
    "/api/v1/roles": {
      "get": {
        "summary": "ロール一覧取得",
        "description": "全てのロールを取得（統計情報含む）",
        "tags": [
          "Roles"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "ロール一覧"
          },
          "401": {
            "description": "認証エラー"
          },
          "403": {
            "description": "権限不足"
          }
        }
      },
      "post": {
        "summary": "ロール作成",
        "description": "新しいロールを作成",
        "tags": [
          "Roles"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "name"
                ],
                "properties": {
                  "name": {
                    "type": "string",
                    "example": "Project Manager"
                  },
                  "description": {
                    "type": "string",
                    "example": "Manages projects"
                  },
                  "priority": {
                    "type": "integer",
                    "example": 50
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "ロール作成成功"
          },
          "400": {
            "description": "バリデーションエラー"
          },
          "401": {
            "description": "認証エラー"
          },
          "403": {
            "description": "権限不足"
          },
          "409": {
            "description": "ロール名の重複"
          }
        }
      }
    },
    "/api/v1/roles/{id}": {
      "patch": {
        "summary": "ロール更新",
        "description": "既存のロール情報を更新",
        "tags": [
          "Roles"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "ロールID"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "description": {
                    "type": "string"
                  },
                  "priority": {
                    "type": "integer"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "ロール更新成功"
          },
          "400": {
            "description": "バリデーションエラー"
          },
          "401": {
            "description": "認証エラー"
          },
          "403": {
            "description": "権限不足"
          },
          "404": {
            "description": "ロールが見つからない"
          },
          "409": {
            "description": "ロール名の重複"
          }
        }
      },
      "delete": {
        "summary": "ロール削除",
        "description": "ロールを削除（システムロールと使用中のロールは削除不可）",
        "tags": [
          "Roles"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "ロールID"
          }
        ],
        "responses": {
          "204": {
            "description": "ロール削除成功"
          },
          "400": {
            "description": "システムロールまたは使用中のロール"
          },
          "401": {
            "description": "認証エラー"
          },
          "403": {
            "description": "権限不足"
          },
          "404": {
            "description": "ロールが見つからない"
          }
        }
      }
    },
    "/api/v1/roles/{id}/permissions": {
      "get": {
        "summary": "ロールの権限一覧取得",
        "description": "指定されたロールに割り当てられた権限の一覧を取得",
        "tags": [
          "Roles"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "ロールID"
          }
        ],
        "responses": {
          "200": {
            "description": "権限一覧"
          },
          "401": {
            "description": "認証エラー"
          },
          "403": {
            "description": "権限不足"
          },
          "404": {
            "description": "ロールが見つからない"
          }
        }
      },
      "post": {
        "summary": "ロールに権限追加",
        "description": "既存のロールに権限を追加（単一または複数）",
        "tags": [
          "Roles"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "ロールID"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "permissionId": {
                    "type": "string",
                    "example": "permission-1",
                    "description": "単一の権限ID"
                  },
                  "permissionIds": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    },
                    "example": [
                      "permission-1",
                      "permission-2"
                    ],
                    "description": "複数の権限ID（バッチ追加）"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "204": {
            "description": "権限追加成功"
          },
          "400": {
            "description": "バリデーションエラー"
          },
          "401": {
            "description": "認証エラー"
          },
          "403": {
            "description": "権限不足"
          },
          "404": {
            "description": "ロールまたは権限が見つからない"
          }
        }
      }
    },
    "/api/v1/roles/{id}/permissions/{permissionId}": {
      "delete": {
        "summary": "ロールから権限削除",
        "description": "ロールから権限を削除（システムロールの必須権限は削除不可）",
        "tags": [
          "Roles"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "ロールID"
          },
          {
            "in": "path",
            "name": "permissionId",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "権限ID"
          }
        ],
        "responses": {
          "204": {
            "description": "権限削除成功"
          },
          "400": {
            "description": "システムロールの必須権限"
          },
          "401": {
            "description": "認証エラー"
          },
          "403": {
            "description": "権限不足"
          },
          "404": {
            "description": "ロールまたは権限が見つからない"
          }
        }
      }
    },
    "/api/v1/auth/sessions": {
      "get": {
        "summary": "Get all sessions",
        "description": "Get all active sessions for the authenticated user",
        "tags": [
          "Sessions"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Sessions retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "sessions": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string",
                            "description": "Session ID"
                          },
                          "deviceInfo": {
                            "type": "string",
                            "description": "Device information (User-Agent)"
                          },
                          "createdAt": {
                            "type": "string",
                            "format": "date-time",
                            "description": "Session creation timestamp"
                          },
                          "expiresAt": {
                            "type": "string",
                            "format": "date-time",
                            "description": "Session expiration timestamp"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          }
        }
      },
      "delete": {
        "summary": "Delete all sessions",
        "description": "Delete all sessions for the authenticated user (logout from all devices)",
        "tags": [
          "Sessions"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "All sessions deleted successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          }
        }
      }
    },
    "/api/v1/auth/sessions/{sessionId}": {
      "delete": {
        "summary": "Delete a specific session",
        "description": "Delete a specific session by session ID (logout from a specific device)",
        "tags": [
          "Sessions"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "sessionId",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "Session ID to delete"
          }
        ],
        "responses": {
          "200": {
            "description": "Session deleted successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "404": {
            "description": "Session not found"
          }
        }
      }
    },
    "/api/projects/{projectId}/site-surveys": {
      "post": {
        "summary": "現場調査作成",
        "description": "新しい現場調査を作成",
        "tags": [
          "Site Surveys"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "projectId",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "プロジェクトID"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "name",
                  "surveyDate"
                ],
                "properties": {
                  "name": {
                    "type": "string",
                    "maxLength": 200
                  },
                  "surveyDate": {
                    "type": "string",
                    "format": "date"
                  },
                  "memo": {
                    "type": "string",
                    "maxLength": 2000,
                    "nullable": true
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "現場調査作成成功"
          },
          "400": {
            "description": "バリデーションエラー"
          },
          "401": {
            "description": "認証エラー"
          },
          "403": {
            "description": "権限不足"
          },
          "404": {
            "description": "プロジェクトが見つからない"
          }
        }
      },
      "get": {
        "summary": "現場調査一覧取得",
        "description": "プロジェクトに紐付く現場調査の一覧を取得（ページネーション、検索、フィルタリング、ソート対応）",
        "tags": [
          "Site Surveys"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "projectId",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "プロジェクトID"
          },
          {
            "in": "query",
            "name": "page",
            "schema": {
              "type": "integer",
              "default": 1
            },
            "description": "ページ番号（1以上）"
          },
          {
            "in": "query",
            "name": "limit",
            "schema": {
              "type": "integer",
              "default": 20,
              "maximum": 100
            },
            "description": "1ページあたりの表示件数（1〜100）"
          },
          {
            "in": "query",
            "name": "search",
            "schema": {
              "type": "string"
            },
            "description": "検索キーワード（名前・メモの部分一致、2文字以上）"
          },
          {
            "in": "query",
            "name": "surveyDateFrom",
            "schema": {
              "type": "string",
              "format": "date"
            },
            "description": "調査日開始（YYYY-MM-DD形式）"
          },
          {
            "in": "query",
            "name": "surveyDateTo",
            "schema": {
              "type": "string",
              "format": "date"
            },
            "description": "調査日終了（YYYY-MM-DD形式）"
          },
          {
            "in": "query",
            "name": "sort",
            "schema": {
              "type": "string",
              "enum": [
                "surveyDate",
                "createdAt",
                "updatedAt"
              ],
              "default": "surveyDate"
            },
            "description": "ソートフィールド"
          },
          {
            "in": "query",
            "name": "order",
            "schema": {
              "type": "string",
              "enum": [
                "asc",
                "desc"
              ],
              "default": "desc"
            },
            "description": "ソート順序"
          }
        ],
        "responses": {
          "200": {
            "description": "現場調査一覧"
          },
          "400": {
            "description": "バリデーションエラー"
          },
          "401": {
            "description": "認証エラー"
          },
          "403": {
            "description": "権限不足"
          }
        }
      }
    },
    "/api/site-surveys/{id}": {
      "get": {
        "summary": "現場調査詳細取得",
        "description": "現場調査の基本情報と関連する画像一覧を取得",
        "tags": [
          "Site Surveys"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "現場調査ID"
          }
        ],
        "responses": {
          "200": {
            "description": "現場調査詳細"
          },
          "400": {
            "description": "無効な現場調査ID形式"
          },
          "401": {
            "description": "認証エラー"
          },
          "403": {
            "description": "権限不足"
          },
          "404": {
            "description": "現場調査が見つからない"
          }
        }
      },
      "put": {
        "summary": "現場調査更新",
        "description": "既存の現場調査情報を更新（楽観的排他制御）",
        "tags": [
          "Site Surveys"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "現場調査ID"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "expectedUpdatedAt"
                ],
                "properties": {
                  "name": {
                    "type": "string",
                    "maxLength": 200
                  },
                  "surveyDate": {
                    "type": "string",
                    "format": "date"
                  },
                  "memo": {
                    "type": "string",
                    "maxLength": 2000,
                    "nullable": true
                  },
                  "expectedUpdatedAt": {
                    "type": "string",
                    "format": "date-time"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "現場調査更新成功"
          },
          "400": {
            "description": "バリデーションエラー"
          },
          "401": {
            "description": "認証エラー"
          },
          "403": {
            "description": "権限不足"
          },
          "404": {
            "description": "現場調査が見つからない"
          },
          "409": {
            "description": "楽観的排他制御エラー（競合）"
          }
        }
      },
      "delete": {
        "summary": "現場調査削除",
        "description": "現場調査と関連する画像データを論理削除",
        "tags": [
          "Site Surveys"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "現場調査ID"
          }
        ],
        "responses": {
          "204": {
            "description": "現場調査削除成功"
          },
          "400": {
            "description": "無効な現場調査ID形式"
          },
          "401": {
            "description": "認証エラー"
          },
          "403": {
            "description": "権限不足"
          },
          "404": {
            "description": "現場調査が見つからない"
          }
        }
      }
    },
    "/api/site-surveys/{id}/images": {
      "get": {
        "summary": "画像一覧取得",
        "description": "現場調査に紐付く画像の一覧を表示順序でソートして取得",
        "tags": [
          "Survey Images"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "現場調査ID"
          }
        ],
        "responses": {
          "200": {
            "description": "画像一覧"
          },
          "401": {
            "description": "認証エラー"
          },
          "403": {
            "description": "権限不足"
          },
          "404": {
            "description": "現場調査が見つからない"
          }
        }
      },
      "post": {
        "summary": "画像アップロード",
        "description": "現場調査に画像をアップロード（複数ファイル対応）",
        "tags": [
          "Survey Images"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "現場調査ID"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "images": {
                    "type": "array",
                    "items": {
                      "type": "string",
                      "format": "binary"
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "アップロード成功"
          },
          "400": {
            "description": "バリデーションエラー"
          },
          "401": {
            "description": "認証エラー"
          },
          "403": {
            "description": "権限不足"
          },
          "404": {
            "description": "現場調査が見つからない"
          },
          "413": {
            "description": "ファイルサイズ超過"
          }
        }
      }
    },
    "/api/site-surveys/{id}/images/order": {
      "put": {
        "summary": "画像順序変更",
        "description": "画像の表示順序を一括変更",
        "tags": [
          "Survey Images"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "現場調査ID"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "orders"
                ],
                "properties": {
                  "orders": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "required": [
                        "id",
                        "order"
                      ],
                      "properties": {
                        "id": {
                          "type": "string",
                          "format": "uuid"
                        },
                        "order": {
                          "type": "integer",
                          "minimum": 1
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "responses": {
          "204": {
            "description": "順序変更成功"
          },
          "400": {
            "description": "バリデーションエラー"
          },
          "401": {
            "description": "認証エラー"
          },
          "403": {
            "description": "権限不足"
          },
          "404": {
            "description": "現場調査または画像が見つからない"
          }
        }
      }
    },
    "/api/site-surveys/images/{imageId}": {
      "delete": {
        "summary": "画像削除",
        "description": "画像と関連する注釈データを削除",
        "tags": [
          "Survey Images"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "imageId",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "画像ID"
          }
        ],
        "responses": {
          "204": {
            "description": "削除成功"
          },
          "400": {
            "description": "無効な画像ID"
          },
          "401": {
            "description": "認証エラー"
          },
          "403": {
            "description": "権限不足"
          },
          "404": {
            "description": "画像が見つからない"
          }
        }
      },
      "patch": {
        "summary": "画像メタデータ更新",
        "description": "画像のコメントと報告書出力フラグを更新",
        "tags": [
          "Survey Images"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "imageId",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "画像ID"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "comment": {
                    "type": "string",
                    "nullable": true,
                    "maxLength": 2000,
                    "description": "写真コメント（最大2000文字、nullでクリア）"
                  },
                  "includeInReport": {
                    "type": "boolean",
                    "description": "報告書出力フラグ"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "更新成功",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": {
                      "type": "string",
                      "format": "uuid"
                    },
                    "comment": {
                      "type": "string",
                      "nullable": true
                    },
                    "includeInReport": {
                      "type": "boolean"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "バリデーションエラー"
          },
          "401": {
            "description": "認証エラー"
          },
          "403": {
            "description": "権限不足"
          },
          "404": {
            "description": "画像が見つからない"
          }
        }
      }
    },
    "/api/site-surveys/images/{imageId}/thumbnail": {
      "patch": {
        "summary": "サムネイル更新",
        "description": "注釈付き画像からサムネイルを再生成して更新",
        "tags": [
          "Survey Images"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "imageId",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "画像ID"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "imageData"
                ],
                "properties": {
                  "imageData": {
                    "type": "string",
                    "description": "Base64エンコードされた画像データ（data:image/...形式）"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "サムネイル更新成功"
          },
          "400": {
            "description": "無効な画像データ"
          },
          "401": {
            "description": "認証エラー"
          },
          "403": {
            "description": "権限不足"
          },
          "404": {
            "description": "画像が見つからない"
          }
        }
      }
    },
    "/api/trading-partners": {
      "get": {
        "summary": "取引先一覧取得",
        "description": "ページネーション、検索、フィルタリング、ソートに対応した取引先一覧を取得",
        "tags": [
          "TradingPartners"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "query",
            "name": "page",
            "schema": {
              "type": "integer",
              "default": 1
            },
            "description": "ページ番号（1以上）"
          },
          {
            "in": "query",
            "name": "limit",
            "schema": {
              "type": "integer",
              "default": 20,
              "maximum": 100
            },
            "description": "1ページあたりの表示件数（1～100）"
          },
          {
            "in": "query",
            "name": "search",
            "schema": {
              "type": "string"
            },
            "description": "検索キーワード（取引先名・フリガナの部分一致）"
          },
          {
            "in": "query",
            "name": "type",
            "schema": {
              "type": "string",
              "enum": [
                "CUSTOMER",
                "SUBCONTRACTOR"
              ]
            },
            "description": "種別フィルター"
          },
          {
            "in": "query",
            "name": "sort",
            "schema": {
              "type": "string",
              "enum": [
                "id",
                "name",
                "nameKana",
                "createdAt",
                "updatedAt"
              ],
              "default": "nameKana"
            },
            "description": "ソートフィールド"
          },
          {
            "in": "query",
            "name": "order",
            "schema": {
              "type": "string",
              "enum": [
                "asc",
                "desc"
              ],
              "default": "asc"
            },
            "description": "ソート順序"
          }
        ],
        "responses": {
          "200": {
            "description": "取引先一覧",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/TradingPartnerInfo"
                      }
                    },
                    "pagination": {
                      "$ref": "#/components/schemas/PaginationInfo"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "バリデーションエラー"
          },
          "401": {
            "description": "認証エラー"
          },
          "403": {
            "description": "権限不足"
          }
        }
      },
      "post": {
        "summary": "取引先作成",
        "description": "新しい取引先を作成",
        "tags": [
          "TradingPartners"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateTradingPartnerRequest"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "取引先作成成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TradingPartnerInfo"
                }
              }
            }
          },
          "400": {
            "description": "バリデーションエラー"
          },
          "401": {
            "description": "認証エラー"
          },
          "403": {
            "description": "権限不足"
          },
          "409": {
            "description": "取引先名重複"
          }
        }
      }
    },
    "/api/trading-partners/search": {
      "get": {
        "summary": "取引先検索（オートコンプリート用）",
        "description": "取引先名またはフリガナで部分一致検索を実行。プロジェクト管理機能からの取引先候補取得に使用",
        "tags": [
          "TradingPartners"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "query",
            "name": "q",
            "required": true,
            "schema": {
              "type": "string",
              "minLength": 1
            },
            "description": "検索クエリ（1文字以上）"
          },
          {
            "in": "query",
            "name": "type",
            "schema": {
              "type": "string",
              "enum": [
                "CUSTOMER",
                "SUBCONTRACTOR"
              ]
            },
            "description": "種別フィルター"
          },
          {
            "in": "query",
            "name": "limit",
            "schema": {
              "type": "integer",
              "default": 10,
              "maximum": 10
            },
            "description": "最大件数（1〜10）"
          }
        ],
        "responses": {
          "200": {
            "description": "検索結果",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/TradingPartnerSearchResult"
                  }
                }
              }
            }
          },
          "400": {
            "description": "バリデーションエラー"
          },
          "401": {
            "description": "認証エラー"
          },
          "403": {
            "description": "権限不足"
          }
        }
      }
    },
    "/api/trading-partners/{id}": {
      "get": {
        "summary": "取引先詳細取得",
        "description": "指定されたIDの取引先詳細を取得",
        "tags": [
          "TradingPartners"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "取引先ID"
          }
        ],
        "responses": {
          "200": {
            "description": "取引先詳細",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TradingPartnerDetail"
                }
              }
            }
          },
          "400": {
            "description": "無効な取引先ID形式"
          },
          "401": {
            "description": "認証エラー"
          },
          "403": {
            "description": "権限不足"
          },
          "404": {
            "description": "取引先が見つからない"
          }
        }
      },
      "put": {
        "summary": "取引先更新",
        "description": "既存の取引先情報を更新（楽観的排他制御）",
        "tags": [
          "TradingPartners"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "取引先ID"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateTradingPartnerRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "取引先更新成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TradingPartnerInfo"
                }
              }
            }
          },
          "400": {
            "description": "バリデーションエラー"
          },
          "401": {
            "description": "認証エラー"
          },
          "403": {
            "description": "権限不足"
          },
          "404": {
            "description": "取引先が見つからない"
          },
          "409": {
            "description": "楽観的排他制御エラー（競合）または取引先名重複"
          }
        }
      },
      "delete": {
        "summary": "取引先削除",
        "description": "取引先を論理削除",
        "tags": [
          "TradingPartners"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            },
            "description": "取引先ID"
          }
        ],
        "responses": {
          "204": {
            "description": "取引先削除成功"
          },
          "400": {
            "description": "無効な取引先ID形式"
          },
          "401": {
            "description": "認証エラー"
          },
          "403": {
            "description": "権限不足"
          },
          "404": {
            "description": "取引先が見つからない"
          },
          "409": {
            "description": "プロジェクト紐付け中のため削除不可"
          }
        }
      }
    },
    "/api/v1/users": {
      "get": {
        "summary": "ユーザー一覧取得",
        "description": "全てのユーザーとそのロールを取得",
        "tags": [
          "Users"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "ユーザー一覧"
          },
          "401": {
            "description": "認証エラー"
          },
          "403": {
            "description": "権限不足"
          }
        }
      }
    },
    "/api/v1/users/{id}/roles": {
      "post": {
        "summary": "ユーザーにロール追加",
        "description": "既存のユーザーにロールを追加（複数ロールの一括割り当てに対応）",
        "tags": [
          "User Roles"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "ユーザーID"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "roleIds"
                ],
                "properties": {
                  "roleIds": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    },
                    "example": [
                      "role-1",
                      "role-2"
                    ]
                  }
                }
              }
            }
          }
        },
        "responses": {
          "204": {
            "description": "ロール追加成功"
          },
          "400": {
            "description": "バリデーションエラー"
          },
          "401": {
            "description": "認証エラー"
          },
          "403": {
            "description": "権限不足"
          },
          "404": {
            "description": "ユーザーまたはロールが見つからない"
          }
        }
      },
      "get": {
        "summary": "ユーザーのロール一覧取得",
        "description": "特定ユーザーに割り当てられたロール一覧を取得",
        "tags": [
          "User Roles"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "ユーザーID"
          }
        ],
        "responses": {
          "200": {
            "description": "ロール一覧"
          },
          "401": {
            "description": "認証エラー"
          },
          "403": {
            "description": "権限不足"
          },
          "404": {
            "description": "ユーザーが見つからない"
          }
        }
      }
    },
    "/api/v1/users/{id}/roles/{roleId}": {
      "delete": {
        "summary": "ユーザーからロール削除",
        "description": "ユーザーからロールを削除（最後の管理者ロールは削除不可）",
        "tags": [
          "User Roles"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "ユーザーID"
          },
          {
            "in": "path",
            "name": "roleId",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "ロールID"
          }
        ],
        "responses": {
          "204": {
            "description": "ロール削除成功"
          },
          "400": {
            "description": "最後の管理者ロール"
          },
          "401": {
            "description": "認証エラー"
          },
          "403": {
            "description": "権限不足"
          },
          "404": {
            "description": "ユーザーまたはロール割り当てが見つからない"
          }
        }
      }
    },
    "/api/v1/users/{id}": {
      "delete": {
        "summary": "ユーザー削除",
        "description": "ユーザーと関連データを削除（自分自身と最後の管理者は削除不可）",
        "tags": [
          "Users"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "ユーザーID"
          }
        ],
        "responses": {
          "204": {
            "description": "ユーザー削除成功"
          },
          "400": {
            "description": "自分自身または最後の管理者の削除は不可"
          },
          "401": {
            "description": "認証エラー"
          },
          "403": {
            "description": "権限不足"
          },
          "404": {
            "description": "ユーザーが見つからない"
          }
        }
      }
    },
    "/api/users/assignable": {
      "get": {
        "summary": "担当者候補一覧取得",
        "description": "admin以外の有効なユーザー一覧を取得（id, displayName）",
        "tags": [
          "Users"
        ],
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "担当者候補一覧",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "id": {
                        "type": "string",
                        "description": "ユーザーID",
                        "example": "550e8400-e29b-41d4-a716-446655440000"
                      },
                      "displayName": {
                        "type": "string",
                        "description": "ユーザー表示名",
                        "example": "山田太郎"
                      }
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "認証エラー"
          },
          "403": {
            "description": "権限不足"
          },
          "500": {
            "description": "サーバーエラー"
          }
        }
      }
    }
  }
}