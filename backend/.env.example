# ============================================
# ArchiTrack Backend Environment Variables
# ============================================

# --------------------------------------------
# Server Configuration
# --------------------------------------------
# Port number for the HTTP server
# DEFAULT: 3000
# REQUIRED: No (uses default if not set)
PORT=3000

# Node environment (development | production | test)
# DEFAULT: development
# REQUIRED: No (uses default if not set)
NODE_ENV=development

# Log level (trace | debug | info | warn | error | fatal)
# DEFAULT: info in production, debug in development
# REQUIRED: No (uses default if not set)
LOG_LEVEL=debug

# --------------------------------------------
# Database Configuration
# --------------------------------------------
# PostgreSQL connection string
# Format: postgresql://USER:PASSWORD@HOST:PORT/DATABASE
#
# For local development (default): use 'localhost'
DATABASE_URL=postgresql://postgres:dev@localhost:5432/architrack_dev
#
# For Docker Compose: use service name 'postgres' (docker-compose.yml overrides this)
#   DATABASE_URL=postgresql://postgres:dev@postgres:5432/architrack_dev
#
# For Railway/Production: use the provided DATABASE_URL from Railway
#   DATABASE_URL=${{Postgres.DATABASE_URL}}
#
# REQUIRED: No (optional, but database features will be disabled without it)

# Database connection timeout in milliseconds (default: 5000ms)
# REQUIRED: No (uses default if not set)
DATABASE_CONNECTION_TIMEOUT=5000

# Database connection retry count (0-10, default: 3)
# REQUIRED: No (uses default if not set)
DATABASE_RETRY_COUNT=3

# --------------------------------------------
# Redis Configuration
# --------------------------------------------
# Redis connection string
# Format: redis://HOST:PORT
#
# For local development (default): use 'localhost'
REDIS_URL=redis://localhost:6379
#
# For Docker Compose: use service name 'redis' (docker-compose.yml overrides this)
#   REDIS_URL=redis://redis:6379
#
# For Railway/Production: use the provided REDIS_URL from Railway
#   REDIS_URL=${{Redis.REDIS_URL}}
#
# REQUIRED: No (optional, rate limiting will fall back to memory store)

# --------------------------------------------
# CORS Configuration
# --------------------------------------------
# Frontend URL for CORS configuration
# This URL will be allowed to make requests to the backend
#
# For local development:
#   FRONTEND_URL=http://localhost:5173
#
# For production:
#   FRONTEND_URL=https://your-frontend.railway.app
#
# DEFAULT: http://localhost:5173
# REQUIRED: No (uses default if not set)
FRONTEND_URL=http://localhost:5173

# --------------------------------------------
# JWT Authentication Configuration
# --------------------------------------------
# EdDSA (Ed25519) public and private keys for JWT signing
# Generate these using: npx tsx scripts/generate-eddsa-keys.ts
#
# Format: Base64-encoded JWK (JSON Web Key)
# The script will output these values to .env.keys
#
# REQUIRED: Yes (for authentication features)
# JWT_PUBLIC_KEY=<base64-encoded-public-jwk>
# JWT_PRIVATE_KEY=<base64-encoded-private-jwk>
#
# Optional: Old public key for grace period during key rotation (30 days)
# JWT_PUBLIC_KEY_OLD=<base64-encoded-old-public-jwk>

# Access token expiry (default: 15m)
# Format: time string (e.g., 15m, 1h, 7d)
# REQUIRED: No (uses default if not set)
ACCESS_TOKEN_EXPIRY=15m

# Refresh token expiry (default: 7d)
# Format: time string (e.g., 7d, 30d)
# REQUIRED: No (uses default if not set)
REFRESH_TOKEN_EXPIRY=7d

# --------------------------------------------
# Two-Factor Authentication (2FA) Configuration
# --------------------------------------------
# AES-256-GCM encryption key for 2FA secrets (256 bits = 32 bytes)
# Generate using: npx tsx scripts/generate-2fa-key.ts
# Alternative: node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"
#
# Format: Base64-encoded 256-bit key
# REQUIRED: Yes (when 2FA features are enabled)
# TWO_FACTOR_ENCRYPTION_KEY=<base64-encoded-256-bit-key>

# --------------------------------------------
# Initial Admin Account Configuration
# --------------------------------------------
# Initial administrator account for the first setup
# These values are only used if no admin account exists
#
# REQUIRED: No (optional, but recommended for automated setups)
# INITIAL_ADMIN_EMAIL=admin@example.com
# INITIAL_ADMIN_PASSWORD=<strong-password-12-chars-min>
# INITIAL_ADMIN_DISPLAY_NAME=System Administrator

# --------------------------------------------
# Monitoring & Alerts (Sentry)
# --------------------------------------------
# Sentry DSN for error tracking and performance monitoring
# Get this from your Sentry project settings
#
# REQUIRED: No (optional, but highly recommended for production)
# SENTRY_DSN=https://examplePublicKey@o0.ingest.sentry.io/0

# --------------------------------------------
# Railway Configuration (Production)
# --------------------------------------------
# These are automatically set by Railway, do not set manually
# RAILWAY_ENVIRONMENT=production
# RAILWAY_SERVICE_NAME=backend

# Enable database migrations on production deploy
# Set to 'true' to run migrations automatically on Railway
# MIGRATE_ON_DEPLOY=true

# --------------------------------------------
# Database Seeding Configuration
# --------------------------------------------
# Enable database seeding in production
# Set to 'true' to run seed script on production deploy
# Default: false (seeds only run in development/test environments)
#
# The seed script creates:
# - Predefined roles (admin, user)
# - Predefined permissions (resource:action format)
# - Role-permission assignments
# - Initial admin user (if INITIAL_ADMIN_* variables are set)
#
# Note: Seed operations are idempotent and safe to run multiple times
# RUN_SEED=true

# --------------------------------------------
# CI/CD Configuration
# --------------------------------------------
# Set to 'true' when running in CI environment
# CI=true

# --------------------------------------------
# Testing & Development Configuration
# --------------------------------------------
# Disable rate limiting for local development and E2E tests
# Set to 'true' to skip API rate limiting
# DEFAULT: false
# REQUIRED: No (should only be true for local development/testing)
# WARNING: Never set to 'true' in production environments
# DISABLE_RATE_LIMIT=true

# --------------------------------------------
# Cloudflare R2 Storage Configuration
# --------------------------------------------
# R2 endpoint URL for S3-compatible API
# Format: https://<account-id>.r2.cloudflarestorage.com
# Get from: Cloudflare Dashboard > R2 > Overview > S3 API
# REQUIRED: Yes (for image upload features)
# R2_ENDPOINT=https://your-account-id.r2.cloudflarestorage.com

# R2 API access credentials
# Generate from: Cloudflare Dashboard > R2 > Manage R2 API Tokens
# REQUIRED: Yes (for image upload features)
# R2_ACCESS_KEY_ID=your-access-key-id
# R2_SECRET_ACCESS_KEY=your-secret-access-key

# R2 bucket name for storing images
# Create from: Cloudflare Dashboard > R2 > Create bucket
# REQUIRED: Yes (for image upload features)
# R2_BUCKET_NAME=architrack-images

# Public URL for accessing images without signed URLs
# Optional: Set if you have configured a custom domain for the bucket
# Format: https://images.yourdomain.com
# REQUIRED: No (optional, for public access to images)
# R2_PUBLIC_URL=https://images.example.com
