FROM node:20-alpine

WORKDIR /app

# Alpine Linux用の必要なビルドツールとヘルスチェック用ツールをインストール
RUN apk add --no-cache python3 make g++ wget

COPY package*.json ./

# npm installを実行し、Alpine用のネイティブモジュールを確実にインストール
RUN npm install

# エントリーポイントスクリプトをコピー
COPY entrypoint.sh /usr/local/bin/entrypoint.sh
RUN chmod +x /usr/local/bin/entrypoint.sh

COPY . .

EXPOSE 5173

CMD ["/usr/local/bin/entrypoint.sh"]
